import{A as Xi,_ as $i,o as it,c as nt,a as Me,t as Gt,w as Gi,v as ji,F as Ui,r as Zi,b as qi}from"./index-21b383b3.js";var Ki=Xi.create({withCredentials:!1});const Ji={get(V,F){return Qi(V,"GET",F)}};async function Qi(V,F="GET",M="BTC"){try{const $=await Ki({url:`https://data.binance.com/api/v3/klines?symbol=${M}USDT&interval=1s`,method:F});return console.log("res.data: ",$.data),$.data}catch($){throw console.log(`Had Issues ${F}ing to the backend, endpoint: ${V}, with data: `,data),console.dir($),$.response&&$.response.status===401&&(sessionStorage.clear(),window.location.assign("/")),$}}const jt={getRate:en,getMarketPriceHistory:tn,getCurrencies:nn};async function en(){}async function tn(V){const F=await Ji.get(`${V}`);return sn(F)}function nn(){return on}function sn(V){return V.reduce((F,M)=>{const $={close:+M[4],high:+M[2],low:+M[3],open:+M[1],timestamp:+M[0],volume:+M[5]};return F.push($),F},[])}const on=["BNB","BTC","ETH","MATIC","ADA","SOL","RIF","DOGE"];var rn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ze={},an={get exports(){return ze},set exports(V){ze=V}},We={},ln={get exports(){return We},set exports(V){We=V}};/**
 * @license
 * KLineChart v9.0.0-alpha7
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */(function(V,F){(function(M,$){$(F)})(rn,function(M){const $=new class{constructor(){this._baseId=1}next(r){const e=new Date().getTime();return e===this._prevIdTimestamp?++this._baseId:this._baseId=1,this._prevIdTimestamp=e,`${r??""}${e}_${this._baseId}`}};function ue(r){return $.next(r)}function U(r,e){var t;const i=document.createElement(r),n=e??{};for(const s in n)i.style[s]=(t=n[s])!==null&&t!==void 0?t:"";return i}let Z;function pe(r){var e,t,i;return(i=(t=(e=r.ownerDocument)===null||e===void 0?void 0:e.defaultView)===null||t===void 0?void 0:t.devicePixelRatio)!==null&&i!==void 0?i:2}function re(r,e,t){return`${e??"normal"} ${r??12}px ${t??"Helvetica Neue"}`}function Ye(r,e,t,i){if(Z===void 0){const n=document.createElement("canvas"),s=pe(n);Z=n.getContext("2d"),Z.scale(s,s)}return Z.font=re(e,t,i),Math.round(Z.measureText(r).width)}function ne(r,e){if(K(r)||K(e)){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const i=r[t],n=e[t];K(n)&&K(i)&&!se(n)&&!se(i)?ne(i,n):L(e[t])&&(r[t]=e[t])}}}function He(r){if(!K(r)||!se(r))return r;let e;e=se(r)?[]:{};for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const i=r[t];K(i)?e[t]=He(i):e[t]=i}return e}function se(r){return Object.prototype.toString.call(r)==="[object Array]"}function Pe(r){return typeof r=="function"}function K(r){return typeof r=="object"}function ke(r){return typeof r=="number"&&!isNaN(r)}function L(r){return r!=null}function ae(r){return typeof r=="string"}const Ut=/\\(\\)?/g,Zt=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function A(r,e,t){if(L(r)){const i=[];e.replace(Zt,(a,...l)=>{let c=a;return L(l[1])?c=l[2].replace(Ut,"$1"):L(l[0])&&(c=l[0].trim()),i.push(c),""});let n=r,s=0;const o=i.length;for(;L(n)&&s<o;)n=n==null?void 0:n[i[s++]];return L(n)?n:t??"--"}return t??"--"}function st(r,e,t){const i=r.format(new Date(e)).split(", "),n=i[0].split("/"),s=i[1].split(":"),o={YYYY:n[2],MM:n[0],DD:n[1],HH:s[0]==="24"?"00":s[0],mm:s[1],ss:s[2]};return t.replace(/YYYY|MM|DD|HH|mm|ss/g,a=>o[a])}function B(r,e){const t=+r;return ke(t)?t.toFixed(e??2):`${t}`}function ot(r){const e=+r;return ke(e)?r>1e9?+(e/1e9).toFixed(3)+"B":r>1e6?+(e/1e6).toFixed(3)+"M":r>1e3?+(e/1e3).toFixed(3)+"K":`${r}`:"--"}function Xe(r,e,t){let i=0,n=0;for(n=r.length-1;i!==n;){const s=Math.floor((n+i)/2),o=n-i,a=r[s][e];if(t===r[i][e])return i;if(t===r[n][e])return n;if(t===a)return s;if(t>a?i=s:n=s,o<=2)break}return i}function rt(r,e){return e==null&&(e=10),e=Math.min(Math.max(0,e),20),+(+r).toFixed(e)}function at(r,e,t){const i=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return r.forEach(n=>{var s,o;i[0]=Math.max((s=n[e])!==null&&s!==void 0?s:n,i[0]),i[1]=Math.min((o=n[t])!==null&&o!==void 0?o:n,i[1])}),i}function be(r){return Math.log(r)/Math.log(10)}function de(r){return Math.pow(10,r)}const qt=1,Kt=50;class Jt{constructor(e){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalBarSpace=0,this._barSpace=6,this._offsetRightDistance=50,this._startScrollOffsetRightBarCount=0,this._minVisibleBarCount={left:2,right:2},this._visibleRange={from:0,to:0},this._chartStore=e,this._gapBarSpace=this._calcGapBarSpace(),this._offsetRightBarCount=this._offsetRightDistance/this._barSpace}_calcGapBarSpace(){const e=Math.floor(.82*this._barSpace),t=Math.floor(this._barSpace),i=Math.min(e,t-1);return Math.max(1,i)}adjustVisibleRange(){var e;const t=this._chartStore.getDataList(),i=t.length,n=this._totalBarSpace/this._barSpace,s=n-Math.min(this._minVisibleBarCount.left,i);this._offsetRightBarCount>s&&(this._offsetRightBarCount=s);const o=-i+Math.min(this._minVisibleBarCount.right,i);this._offsetRightBarCount<o&&(this._offsetRightBarCount=o);let a=Math.round(this._offsetRightBarCount+i+.5);a>i&&(a=i);let l=Math.round(a-n)-1;if(l<0&&(l=0),this._visibleRange={from:l,to:a},this._chartStore.getActionStore().execute("onVisibleDataChange",{from:l,to:a}),this._chartStore.adjustVisibleDataList(),l===0&&this._more&&!this._loading&&this._loadMoreCallback!==null){this._loading=!0;const c=t[0];this._loadMoreCallback((e=c==null?void 0:c.timestamp)!==null&&e!==void 0?e:null)}}setMore(e){return this._more=e,this}setLoading(e){return this._loading=e,this}getDateTimeFormat(){return this._dateTimeFormat}_buildDateTimeFormat(e){const t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};e!==void 0&&(t.timeZone=e);let i=null;try{i=new Intl.DateTimeFormat("en",t)}catch{}return i}setTimezone(e){const t=this._buildDateTimeFormat(e);t!==null&&(this._dateTimeFormat=t)}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:this._gapBarSpace/2}}setBarSpace(e,t){e<qt||e>Kt||this._barSpace===e||(this._barSpace=e,this._gapBarSpace=this._calcGapBarSpace(),t==null||t(),this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))}setTotalBarSpace(e){return this._totalBarSpace!==e&&(this._totalBarSpace=e,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0)),this}setOffsetRightDistance(e,t){return this._offsetRightDistance=e,this._offsetRightBarCount=e/this._barSpace,t!=null&&t&&(this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this}resetOffsetRightDistance(){this.setOffsetRightDistance(this._offsetRightDistance)}getOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightBarCount(){return this._offsetRightBarCount}setOffsetRightBarCount(e){return this._offsetRightBarCount=e,this}setLeftMinVisibleBarCount(e){return this._minVisibleBarCount.left=e,this}setRightMinVisibleBarCount(e){return this._minVisibleBarCount.right=e,this}getVisibleRange(){return this._visibleRange}startScroll(){this._startScrollOffsetRightBarCount=this._offsetRightBarCount}scroll(e){if(!this._scrollEnabled)return;const t=e/this._barSpace;this._chartStore.getActionStore().execute("onScroll"),this._offsetRightBarCount=this._startScrollOffsetRightBarCount-t,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)}getDataByDataIndex(e){var t;return(t=this._chartStore.getDataList()[e])!==null&&t!==void 0?t:null}coordinateToFloatIndex(e){const t=this._chartStore.getDataList().length,i=(this._totalBarSpace-e)/this._barSpace,n=t+this._offsetRightBarCount-i;return Math.round(1e6*n)/1e6}dataIndexToTimestamp(e){var t;const i=this.getDataByDataIndex(e);return(t=i==null?void 0:i.timestamp)!==null&&t!==void 0?t:null}timestampToDataIndex(e){const t=this._chartStore.getDataList();return t.length===0?0:Xe(t,"timestamp",e)}dataIndexToCoordinate(e){const t=this._chartStore.getDataList().length+this._offsetRightBarCount-e;return this._totalBarSpace-(t-.5)*this._barSpace}coordinateToDataIndex(e){return Math.ceil(this.coordinateToFloatIndex(e))-1}zoom(e,t){if(!this._zoomEnabled)return;if((t==null?void 0:t.x)===void 0){const s=this._chartStore.getCrosshairStore().get();t={x:(s==null?void 0:s.x)!==void 0?s.x:this._totalBarSpace/2}}this._chartStore.getActionStore().execute("onZoom");const i=this.coordinateToFloatIndex(t.x),n=this._barSpace+e*(this._barSpace/10);this.setBarSpace(n,()=>{this._offsetRightBarCount+=i-this.coordinateToFloatIndex(t==null?void 0:t.x)})}setZoomEnabled(e){return this._zoomEnabled=e,this}getZoomEnabled(){return this._zoomEnabled}setScrollEnabled(e){return this._scrollEnabled=e,this}getScrollEnabled(){return this._scrollEnabled}setLoadMoreCallback(e){return this._loadMoreCallback=e,this}clear(){this._more=!0,this._loading=!0,this._visibleRange={from:0,to:0}}}function $e(r,e,t,i,n){const s=e.result,o=e.figures,a=e.styles,l=A(a,"circles",i.circles),c=l.length,h=A(a,"bars",i.bars),u=h.length,d=A(a,"lines",i.lines),g=d.length;let p,m,v,_=0,x=0,f=0,y=0;o.forEach(S=>{var b,C,w,T;switch(S.type){case"circle":p=l[_%c],m=p.style,v=p.noChangeColor,y=_,_++;break;case"bar":p=h[x%u],m=p.style,v=p.noChangeColor,y=x,x++;break;case"line":p=d[f%g],m=p.style,v=p.color,y=f,f++}if(L(p)){const I={prev:{kLineData:r[t-1],indicatorData:s[t-1]},current:{kLineData:r[t],indicatorData:s[t]},next:{kLineData:r[t+1],indicatorData:s[t+1]}},k=(C=(b=S.styles)===null||b===void 0?void 0:b.call(S,I,e,i))!==null&&C!==void 0?C:{style:m,color:v};n(S,{style:(w=k.style)!==null&&w!==void 0?w:m,color:(T=k.color)!==null&&T!==void 0?T:v},p,y)}})}class Ae{constructor(e){this.result=[],this._precisionFlag=!1;const{name:t,shortName:i,series:n,calcParams:s,figures:o,precision:a,shouldOhlc:l,shouldFormatBigNumber:c,minValue:h,maxValue:u,styles:d,extendData:g,regenerateFigures:p,createTooltipDataSource:m,draw:v}=e;this.name=t,this.shortName=i??t,this.series=n??"normal",this.precision=a??4,this.calcParams=s??[],this.figures=o??[],this.shouldOhlc=l!=null&&l,this.shouldFormatBigNumber=c!=null&&c,this.minValue=h??null,this.maxValue=u??null,this.styles=d??null,this.extendData=g,this.regenerateFigures=p??null,this.createTooltipDataSource=m??null,this.draw=v??null}setShortName(e){return this.shortName!==e&&(this.shortName=e,!0)}setSeries(e){return this.series!==e&&(this.series=e,!0)}setPrecision(e,t){const i=t!=null&&t,n=Math.floor(e);return!(!(n!==this.precision&&e>=0)||i&&(!i||this._precisionFlag))&&(this.precision=n,i||(this._precisionFlag=!0),!0)}setCalcParams(e){var t,i;return this.calcParams=e,this.figures=(i=(t=this.regenerateFigures)===null||t===void 0?void 0:t.call(this,e))!==null&&i!==void 0?i:this.figures,!0}setShouldOhlc(e){return this.shouldOhlc!==e&&(this.shouldOhlc=e,!0)}setShouldFormatBigNumber(e){return this.shouldFormatBigNumber!==e&&(this.shouldFormatBigNumber=e,!0)}setStyles(e){return this.styles!==e&&(this.styles=e,!0)}setExtendData(e){return this.extendData!==e&&(this.extendData=e,!0)}setFigures(e){return this.figures!==e&&(this.figures=e,!0)}setMinValue(e){return this.minValue!==e&&(this.minValue=e,!0)}setMaxValue(e){return this.maxValue!==e&&(this.maxValue=e,!0)}setRegenerateFigures(e){return this.regenerateFigures!==e&&(this.regenerateFigures=e,!0)}setCreateTooltipDataSource(e){return this.createTooltipDataSource!==e&&(this.createTooltipDataSource=e,!0)}setDraw(e){return this.draw!==e&&(this.draw=e,!0)}async calcIndicator(e){try{const t=await this.calc(e,this);return this.result=t,!0}catch{return!1}}static extend(e){return class extends Ae{constructor(){super(e)}calc(t,i){return e.calc(t,i)}}}}const Qt={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:r=>r.map((e,t)=>{const i=t+1;return{key:`rsi${i}`,title:`RSI${i}: `,type:"line"}}),calc:(r,e)=>{const{calcParams:t,figures:i}=e,n=[],s=[];return r.map((o,a)=>{var l;const c={},h=((l=r[a-1])!==null&&l!==void 0?l:o).close,u=o.close-h;return t.forEach((d,g)=>{var p,m,v;if(u>0?n[g]=((p=n[g])!==null&&p!==void 0?p:0)+u:s[g]=((m=s[g])!==null&&m!==void 0?m:0)+Math.abs(u),a>=d-1){s[g]!==0?c[i[g].key]=100-100/(1+n[g]/s[g]):c[i[g].key]=0;const _=r[a-(d-1)],x=(v=r[a-d])!==null&&v!==void 0?v:_,f=_.close-x.close;f>0?n[g]-=f:s[g]-=Math.abs(f)}}),c})}},ei={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(r,e,t)=>{const i=r.current.kLineData;let n;return n=i.close>i.open?A(e.styles,"bars[0].upColor",t.bars[0].upColor):i.close<i.open?A(e.styles,"bars[0].downColor",t.bars[0].downColor):A(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor),{color:n}}}],regenerateFigures:r=>{const e=r.map((t,i)=>({key:`ma${i+1}`,title:`MA${t}: `,type:"line"}));return e.push({key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,i,n)=>{const s=t.current.kLineData;let o;return o=s.close>s.open?A(i.styles,"bars[0].upColor",n.bars[0].upColor):s.close<s.open?A(i.styles,"bars[0].downColor",n.bars[0].downColor):A(i.styles,"bars[0].noChangeColor",n.bars[0].noChangeColor),{color:o}}}),e},calc:(r,e)=>{const{calcParams:t,figures:i}=e,n=[];return r.map((s,o)=>{var a;const l=(a=s.volume)!==null&&a!==void 0?a:0,c={volume:l};return t.forEach((h,u)=>{var d,g;n[u]=((d=n[u])!==null&&d!==void 0?d:0)+l,o>=h-1&&(c[i[u].key]=n[u]/h,n[u]-=(g=r[o-(h-1)].volume)!==null&&g!==void 0?g:0)}),c})}},ti={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:r=>r.map((e,t)=>({key:`wr${t+1}`,title:`WR${t+1}: `,type:"line"})),calc:(r,e)=>{const{calcParams:t,figures:i}=e;return r.map((n,s)=>{const o={},a=n.close;return t.forEach((l,c)=>{const h=l-1;if(s>=h){const u=at(r.slice(s-h,s+1),"high","low"),d=u[0],g=d-u[1];o[i[c].key]=g===0?0:(a-d)/g*100}}),o})}},Fe={},ii=[{name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:r=>{let e=0,t=0;return r.map(i=>{var n,s;const o={},a=(n=i==null?void 0:i.turnover)!==null&&n!==void 0?n:0,l=(s=i==null?void 0:i.volume)!==null&&s!==void 0?s:0;return e+=a,t+=l,t!==0&&(o.avp=e/t),o})}},{name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:(r,e,t)=>{var i,n,s,o;const{prev:a,current:l}=r,c=(n=(i=a.indicatorData)===null||i===void 0?void 0:i.ao)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER,h=(o=(s=l.indicatorData)===null||s===void 0?void 0:s.ao)!==null&&o!==void 0?o:Number.MIN_SAFE_INTEGER;let u;return u=h>c?A(e.styles,"bars[0].upColor",t.bars[0].upColor):A(e.styles,"bars[0].downColor",t.bars[0].downColor),{color:u,style:h>c?"stroke":"fill"}}}],calc:(r,e)=>{const t=e.calcParams,i=Math.max(t[0],t[1]);let n=0,s=0,o=0,a=0;return r.map((l,c)=>{const h={},u=(l.low+l.high)/2;if(n+=u,s+=u,c>=t[0]-1){o=n/t[0];const d=r[c-(t[0]-1)];n-=(d.low+d.high)/2}if(c>=t[1]-1){a=s/t[1];const d=r[c-(t[1]-1)];s-=(d.low+d.high)/2}return c>=i-1&&(h.ao=o-a),h})}},{name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:r=>r.map((e,t)=>({key:`bias${t+1}`,title:`BIAS${e}: `,type:"line"})),calc:(r,e)=>{const{calcParams:t,figures:i}=e,n=[];return r.map((s,o)=>{const a={},l=s.close;return t.forEach((c,h)=>{var u;if(n[h]=((u=n[h])!==null&&u!==void 0?u:0)+l,o>=c-1){const d=n[h]/t[h];a[i[h].key]=(l-d)/d*100,n[h]-=r[o-(c-1)].close}}),a})}},{name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=t[0]-1;let n=0;return r.map((s,o)=>{const a=s.close,l={};if(n+=a,o>=i){l.mid=n/t[0];const c=function(h,u){const d=h.length;let g=0;return h.forEach(p=>{const m=p.close-u;g+=m*m}),g=Math.abs(g),Math.sqrt(g/d)}(r.slice(o-i,o+1),l.mid);l.up=l.mid+t[1]*c,l.dn=l.mid-t[1]*c,n-=r[o-i].close}return l})}},{name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0,n=0,s=0,o=0;return r.map((a,l)=>{var c,h;const u={},d=a.high,g=a.low,p=a.open,m=((c=r[l-1])!==null&&c!==void 0?c:a).close;if(s+=d-p,o+=p-g,i+=d-m,n+=m-g,l>=t[0]-1){u.ar=o!==0?s/o*100:0,u.br=n!==0?i/n*100:0;const v=r[l-(t[0]-1)],_=v.high,x=v.low,f=v.open,y=((h=r[l-t[0]])!==null&&h!==void 0?h:r[l-(t[0]-1)]).close;i-=_-y,n-=y-x,s-=_-f,o-=f-x}return u})}},{name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=Math.max(...t),n=[],s=[];return r.map((o,a)=>{const l={},c=o.close;if(t.forEach((h,u)=>{var d;n[u]=((d=n[u])!==null&&d!==void 0?d:0)+c,a>=h-1&&(s[u]=n[u]/h,n[u]-=r[a-(h-1)].close)}),a>=i-1){let h=0;s.forEach(u=>{h+=u}),l.bbi=h/4}return l})}},{name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=t[0]-1;let n=0;const s=[];return r.map((o,a)=>{const l={},c=(o.high+o.low+o.close)/3;if(n+=c,s.push(c),a>=i){const h=n/t[0],u=s.slice(a-i,a+1);let d=0;u.forEach(m=>{d+=Math.abs(m-h)});const g=d/t[0];l.cci=g!==0?(c-h)/g/.015:0;const p=(r[a-i].high+r[a-i].low+r[a-i].close)/3;n-=p}return l})}},{name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=Math.ceil(t[1]/2.5+1),n=Math.ceil(t[2]/2.5+1),s=Math.ceil(t[3]/2.5+1),o=Math.ceil(t[4]/2.5+1);let a=0;const l=[];let c=0;const h=[];let u=0;const d=[];let g=0;const p=[],m=[];return r.forEach((v,_)=>{var x,f,y,S,b;const C={},w=(x=r[_-1])!==null&&x!==void 0?x:v,T=(w.high+w.close+w.low+w.open)/4,I=Math.max(0,v.high-T),k=Math.max(0,T-v.low);_>=t[0]-1&&(C.cr=k!==0?I/k*100:0,a+=C.cr,c+=C.cr,u+=C.cr,g+=C.cr,_>=t[0]+t[1]-2&&(l.push(a/t[1]),_>=t[0]+t[1]+i-3&&(C.ma1=l[l.length-1-i]),a-=(f=m[_-(t[1]-1)].cr)!==null&&f!==void 0?f:0),_>=t[0]+t[2]-2&&(h.push(c/t[2]),_>=t[0]+t[2]+n-3&&(C.ma2=h[h.length-1-n]),c-=(y=m[_-(t[2]-1)].cr)!==null&&y!==void 0?y:0),_>=t[0]+t[3]-2&&(d.push(u/t[3]),_>=t[0]+t[3]+s-3&&(C.ma3=d[d.length-1-s]),u-=(S=m[_-(t[3]-1)].cr)!==null&&S!==void 0?S:0),_>=t[0]+t[4]-2&&(p.push(g/t[4]),_>=t[0]+t[4]+o-3&&(C.ma4=p[p.length-1-o]),g-=(b=m[_-(t[4]-1)].cr)!==null&&b!==void 0?b:0)),m.push(C)}),m}},{name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=Math.max(t[0],t[1]);let n=0,s=0,o=0;const a=[];return r.forEach((l,c)=>{var h;const u={},d=l.close;n+=d,s+=d;let g=0,p=0;if(c>=t[0]-1&&(g=n/t[0],n-=r[c-(t[0]-1)].close),c>=t[1]-1&&(p=s/t[1],s-=r[c-(t[1]-1)].close),c>=i-1){const m=g-p;u.dma=m,o+=m,c>=i+t[2]-2&&(u.ama=o/t[2],o-=(h=a[c-(t[2]-1)].dma)!==null&&h!==void 0?h:0)}a.push(u)}),a}},{name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0,n=0,s=0,o=0,a=0,l=0,c=0,h=0;const u=[];return r.forEach((d,g)=>{var p,m;const v={},_=(p=r[g-1])!==null&&p!==void 0?p:d,x=_.close,f=d.high,y=d.low,S=f-y,b=Math.abs(f-x),C=Math.abs(x-y),w=f-_.high,T=_.low-y,I=Math.max(Math.max(S,b),C),k=w>0&&w>T?w:0,O=T>0&&T>w?T:0;if(i+=I,n+=k,s+=O,g>=t[0]-1){g>t[0]-1?(o=o-o/t[0]+I,a=a-a/t[0]+k,l=l-l/t[0]+O):(o=i,a=n,l=s);let Y=0,R=0;o!==0&&(Y=100*a/o,R=100*l/o),v.pdi=Y,v.mdi=R;let P=0;R+Y!==0&&(P=Math.abs(R-Y)/(R+Y)*100),c+=P,g>=2*t[0]-2&&(h=g>2*t[0]-2?(h*(t[0]-1)+P)/t[0]:c/t[0],v.adx=h,g>=2*t[0]+t[1]-3&&(v.adxr=(((m=u[g-(t[1]-1)].adx)!==null&&m!==void 0?m:0)+h)/2))}u.push(v)}),u}},{name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0,n=0;const s=[],o=[];return r.forEach((a,l)=>{var c,h,u;const d={},g=(c=r[l-1])!==null&&c!==void 0?c:a,p=a.high,m=a.low,v=(h=a.turnover)!==null&&h!==void 0?h:0,_=(p+m)/2,x=(g.high+g.low)/2;let f=0;v!==0&&(f=(_-x)*(p-m)/v),s.push(f),i+=f,l>=t[0]-1&&(d.emv=i,i-=s[l-(t[0]-1)],n+=d.emv,l>=t[0]+t[1]-2&&(d.maEmv=n/t[1],n-=(u=o[l-(t[1]-1)].emv)!==null&&u!==void 0?u:0)),o.push(d)}),o}},{name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:r=>r.map((e,t)=>({key:`ema${t+1}`,title:`EMA${e}: `,type:"line"})),calc:(r,e)=>{const{calcParams:t,figures:i}=e;let n=0;const s=[];return r.map((o,a)=>{const l={},c=o.close;return n+=c,t.forEach((h,u)=>{a>=h-1&&(s[u]=a>h-1?(2*c+(h-1)*s[u])/(h+1):n/h,l[i[u].key]=s[u])}),l})}},{name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0;const n=[];return r.forEach((s,o)=>{var a;const l={};if(o>=t[0]){const c=s.close,h=r[o-t[0]].close;l.mtm=c-h,i+=l.mtm,o>=t[0]+t[1]-1&&(l.maMtm=i/t[1],i-=(a=n[o-(t[1]-1)].mtm)!==null&&a!==void 0?a:0)}n.push(l)}),n}},{name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regenerateFigures:r=>r.map((e,t)=>({key:`ma${t+1}`,title:`MA${e}: `,type:"line"})),calc:(r,e)=>{const{calcParams:t,figures:i}=e,n=[];return r.map((s,o)=>{const a={},l=s.close;return t.forEach((c,h)=>{var u;n[h]=((u=n[h])!==null&&u!==void 0?u:0)+l,o>=c-1&&(a[i[h].key]=n[h]/c,n[h]-=r[o-(c-1)].close)}),a})}},{name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:(r,e,t)=>{var i,n,s,o;const{prev:a,current:l}=r,c=(n=(i=a.indicatorData)===null||i===void 0?void 0:i.macd)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER,h=(o=(s=l.indicatorData)===null||s===void 0?void 0:s.macd)!==null&&o!==void 0?o:Number.MIN_SAFE_INTEGER;let u;return u=h>0?A(e.styles,"bars[0].upColor",t.bars[0].upColor):h<0?A(e.styles,"bars[0].downColor",t.bars[0].downColor):A(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor),{style:c<h?"stroke":"fill",color:u}}}],calc:(r,e)=>{const t=e.calcParams;let i,n,s=0,o=0,a=0,l=0;const c=Math.max(t[0],t[1]);return r.map((h,u)=>{const d={},g=h.close;return s+=g,u>=t[0]-1&&(i=u>t[0]-1?(2*g+(t[0]-1)*i)/(t[0]+1):s/t[0]),u>=t[1]-1&&(n=u>t[1]-1?(2*g+(t[1]-1)*n)/(t[1]+1):s/t[1]),u>=c-1&&(o=i-n,d.dif=o,a+=o,u>=c+t[2]-2&&(l=u>c+t[2]-2?(2*o+l*(t[2]-1))/(t[2]+1):a/t[2],d.macd=2*(o-l),d.dea=l)),d})}},{name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0,n=0;const s=[];return r.forEach((o,a)=>{var l,c,h,u;const d=(l=r[a-1])!==null&&l!==void 0?l:o;o.close<d.close?n-=(c=o.volume)!==null&&c!==void 0?c:0:o.close>d.close&&(n+=(h=o.volume)!==null&&h!==void 0?h:0);const g={obv:n};i+=n,a>=t[0]-1&&(g.maObv=i/t[0],i-=(u=s[a-(t[0]-1)].obv)!==null&&u!==void 0?u:0),s.push(g)}),s}},{name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:r=>{let e=0;return r.map((t,i)=>{var n,s;const o={},a=t.close,l=(n=t.volume)!==null&&n!==void 0?n:1,c=((s=r[i-1])!==null&&s!==void 0?s:t).close;let h=0;const u=c*l;return u!==0&&(h=(a-c)/u),e+=h,o.pvt=e,o})}},{name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0,n=0;const s=[],o=[];return r.forEach((a,l)=>{var c,h;const u={},d=((c=r[l-1])!==null&&c!==void 0?c:a).close,g=a.close-d>0?1:0;s.push(g),i+=g,l>=t[0]-1&&(u.psy=i/t[0]*100,n+=u.psy,l>=t[0]+t[1]-2&&(u.maPsy=n/t[1],n-=(h=o[l-(t[1]-1)].psy)!==null&&h!==void 0?h:0),i-=s[l-(t[0]-1)]),o.push(u)}),o}},{name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=[];let n=0;return r.forEach((s,o)=>{var a,l;const c={};if(o>=t[0]-1){const h=s.close,u=((a=r[o-t[0]])!==null&&a!==void 0?a:r[o-(t[0]-1)]).close;c.roc=u!==0?(h-u)/u*100:0,n+=c.roc,o>=t[0]-1+t[1]-1&&(c.maRoc=n/t[1],n-=(l=i[o-(t[1]-1)].roc)!==null&&l!==void 0?l:0)}i.push(c)}),i}},Qt,{name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(r,e)=>{const t=e.calcParams;let i=0,n=0;return r.map((s,o)=>{const a={},l=s.close;return i+=l,o>=t[0]-1&&(n=o>t[0]-1?(l*t[1]+n*(t[0]-t[1]+1))/(t[0]+1):i/t[0],a.sma=n),a})}},{name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams,i=[];return r.forEach((n,s)=>{var o,a,l,c;const h={},u=n.close;if(s>=t[0]-1){const d=at(r.slice(s-(t[0]-1),s+1),"high","low"),g=d[0],p=d[1],m=g-p,v=(u-p)/(m===0?1:m)*100;h.k=((t[1]-1)*((a=(o=i[s-1])===null||o===void 0?void 0:o.k)!==null&&a!==void 0?a:50)+v)/t[1],h.d=((t[2]-1)*((c=(l=i[s-1])===null||l===void 0?void 0:l.d)!==null&&c!==void 0?c:50)+h.k)/t[2],h.j=3*h.k-2*h.d}i.push(h)}),i}},{name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:(r,e,t)=>{var i,n;const{current:s}=r,o=(n=(i=s.indicatorData)===null||i===void 0?void 0:i.sar)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER,a=s.kLineData;return{color:o<((a==null?void 0:a.high)+(a==null?void 0:a.low))/2?A(e.styles,"circles[0].upColor",t.circles[0].upColor):A(e.styles,"circles[0].downColor",t.circles[0].downColor)}}}],calc:(r,e)=>{const t=e.calcParams,i=t[0]/100,n=t[1]/100,s=t[2]/100;let o=i,a=-100,l=!1,c=0;return r.map((h,u)=>{const d=c,g=h.high,p=h.low;if(l){(a===-100||a<g)&&(a=g,o=Math.min(o+n,s)),c=d+o*(a-d);const m=Math.min(r[Math.max(1,u)-1].low,p);c>h.low?(c=a,o=i,a=-100,l=!l):c>m&&(c=m)}else{(a===-100||a>p)&&(a=p,o=Math.min(o+n,s)),c=d+o*(a-d);const m=Math.max(r[Math.max(1,u)-1].high,g);c<h.high?(c=a,o=0,a=-100,l=!l):c<m&&(c=m)}return{sar:c}})}},{name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i,n,s,o=0,a=0,l=0,c=0;const h=[];return r.forEach((u,d)=>{var g;const p={},m=u.close;if(o+=m,d>=t[0]-1&&(i=d>t[0]-1?(2*m+(t[0]-1)*i)/(t[0]+1):o/t[0],a+=i,d>=2*t[0]-2&&(n=d>2*t[0]-2?(2*i+(t[0]-1)*n)/(t[0]+1):a/t[0],l+=n,d>=3*t[0]-3))){let v,_=0;d>3*t[0]-3?(v=(2*n+(t[0]-1)*s)/(t[0]+1),_=(v-s)/s*100):v=l/t[0],s=v,p.trix=_,c+=_,d>=3*t[0]+t[1]-4&&(p.maTrix=c/t[1],c-=(g=h[d-(t[1]-1)].trix)!==null&&g!==void 0?g:0)}h.push(p)}),h}},ei,{name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(r,e)=>{const t=e.calcParams;let i=0,n=0,s=0,o=0;const a=[];return r.forEach((l,c)=>{var h,u,d,g,p;const m={},v=l.close,_=((h=r[c-1])!==null&&h!==void 0?h:l).close,x=(u=l.volume)!==null&&u!==void 0?u:0;if(v>_?i+=x:v<_?n+=x:s+=x,c>=t[0]-1){const f=s/2;m.vr=n+f===0?0:(i+f)/(n+f)*100,o+=m.vr,c>=t[0]+t[1]-2&&(m.maVr=o/t[1],o-=(d=a[c-(t[1]-1)].vr)!==null&&d!==void 0?d:0);const y=r[c-(t[0]-1)],S=(g=r[c-t[0]])!==null&&g!==void 0?g:y,b=y.close,C=(p=y.volume)!==null&&p!==void 0?p:0;b>S.close?i-=C:b<S.close?n-=C:s-=C}a.push(m)}),a}},ti];function lt(r){var e;return(e=Fe[r])!==null&&e!==void 0?e:null}ii.forEach(r=>{Fe[r.name]=Ae.extend(r)});class ni{constructor(e){this._instances=new Map,this._chartStore=e}_overrideInstance(e,t){const{shortName:i,series:n,calcParams:s,precision:o,figures:a,minValue:l,maxValue:c,shouldOhlc:h,shouldFormatBigNumber:u,styles:d,extendData:g,regenerateFigures:p,createTooltipDataSource:m,draw:v,calc:_}=t;let x=!1;i!==void 0&&e.setShortName(i)&&(x=!0),n!==void 0&&e.setSeries(n)&&(x=!0);let f=!1;return s!==void 0&&e.setCalcParams(s)&&(x=!0,f=!0),a!==void 0&&e.setFigures(a)&&(x=!0,f=!0),l!==void 0&&e.setMinValue(l)&&(x=!0),c!==void 0&&e.setMinValue(c)&&(x=!0),o!==void 0&&e.setPrecision(o)&&(x=!0),h!==void 0&&e.setShouldOhlc(h)&&(x=!0),u!==void 0&&e.setShouldFormatBigNumber(u)&&(x=!0),d!==void 0&&e.setStyles(d)&&(x=!0),g!==void 0&&e.setExtendData(g)&&(x=!0,f=!0),p!==void 0&&e.setRegenerateFigures(p)&&(x=!0),m!==void 0&&e.setCreateTooltipDataSource(m)&&(x=!0),v!==void 0&&e.setDraw(v)&&(x=!0),_!==void 0&&(e.calc=_,f=!0),[x,f]}async addInstance(e,t,i){var n;const{name:s}=e;let o=this._instances.get(t);if((n=o==null?void 0:o.has(s))!==null&&n!==void 0&&n)return await Promise.reject(new Error("Duplicate indicators."));o===void 0&&(o=new Map,this._instances.set(t,o));const a=new(lt(s));return this._overrideInstance(a,e),i||o.clear(),o.set(s,a),await a.calcIndicator(this._chartStore.getDataList())}getInstances(e){var t;return(t=this._instances.get(e))!==null&&t!==void 0?t:new Map}removeInstance(e,t){let i=!1;if(this._instances.has(e)){const n=this._instances.get(e);t!==void 0?n.has(t)&&(n.delete(t),i=!0):(n.clear(),i=!0),n.size===0&&this._instances.delete(e)}return i}hasInstances(e){return this._instances.has(e)}async calcInstance(e,t){var i;const n=[];if(e!==void 0)if(t!==void 0){const s=this._instances.get(t);if((i=s==null?void 0:s.has(e))!==null&&i!==void 0&&i){const o=s==null?void 0:s.get(e);n.push(o.calcIndicator(this._chartStore.getDataList()))}}else this._instances.forEach(s=>{if(s.has(e)){const o=s==null?void 0:s.get(e);n.push(o.calcIndicator(this._chartStore.getDataList()))}});else this._instances.forEach(s=>{s.forEach(o=>{n.push(o.calcIndicator(this._chartStore.getDataList()))})});return await Promise.all(n)}getInstanceByPaneId(e,t){var i;if(e!==void 0){const n=this._instances.get(e);return t!==void 0?(i=n==null?void 0:n.get(t))!==null&&i!==void 0?i:null:n??null}return this._instances}setSeriesPrecision(e){this._instances.forEach(t=>{t.forEach(i=>{i.series==="price"&&i.setPrecision(e.price,!0),i.series==="volume"&&i.setPrecision(e.volume,!0)})})}async override(e,t){const{name:i}=e;let n=new Map;t!==null?this._instances.has(t)&&n.set(t,this._instances.get(t)):n=this._instances;const s=[];return n.forEach(o=>{if(o.has(i)){const a=o.get(i);this._overrideInstance(a,e)[1]&&s.push(a.calcIndicator(this._chartStore.getDataList()))}}),await Promise.all(s)}}class si{constructor(e){this._crosshair={},this._chartStore=e}set(e,t){const i=this._chartStore.getDataList(),n=e??{};let s,o;n.x!==void 0?(s=this._chartStore.getTimeScaleStore().coordinateToDataIndex(n.x),o=s<0?0:s>i.length-1?i.length-1:s):(s=i.length-1,o=s);const a=i[o],l=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(s),c=this._crosshair.x,h=this._crosshair.y,u=this._crosshair.paneId;return this._crosshair={...n,realX:l,kLineData:a,realDataIndex:s,dataIndex:o},c===n.x&&h===n.y&&u===n.paneId||(a!==null&&this._chartStore.getChart().crosshairChange(this._crosshair),t!=null&&t||this._chartStore.getChart().updatePane(1)),this}recalculate(e){this.set(this._crosshair,e)}get(){return this._crosshair}}class Le{constructor(e){this.currentStep=1,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];const{mode:t,extendData:i,styles:n,name:s,totalStep:o,lock:a,needDefaultPointFigure:l,needDefaultXAxisFigure:c,needDefaultYAxisFigure:h,createPointFigures:u,createXAxisFigures:d,createYAxisFigures:g,performEventPressedMove:p,performEventMoveForDrawing:m,onDrawStart:v,onDrawing:_,onDrawEnd:x,onClick:f,onRightClick:y,onPressedMoveStart:S,onPressedMoving:b,onPressedMoveEnd:C,onMouseEnter:w,onMouseLeave:T,onRemoved:I,onSelected:k,onDeselected:O}=e;this.name=s,this.totalStep=o===void 0||o<2?1:o,this.lock=a!=null&&a,this.needDefaultPointFigure=l!=null&&l,this.needDefaultXAxisFigure=c!=null&&c,this.needDefaultYAxisFigure=h!=null&&h,this.mode=t??"normal",this.extendData=i,this.styles=n??null,this.createPointFigures=u??null,this.createXAxisFigures=d??null,this.createYAxisFigures=g??null,this.performEventPressedMove=p??null,this.performEventMoveForDrawing=m??null,this.onDrawStart=v??null,this.onDrawing=_??null,this.onDrawEnd=x??null,this.onClick=f??null,this.onRightClick=y??null,this.onPressedMoveStart=S??null,this.onPressedMoving=b??null,this.onPressedMoveEnd=C??null,this.onMouseEnter=w??null,this.onMouseLeave=T??null,this.onRemoved=I??null,this.onSelected=k??null,this.onDeselected=O??null}setId(e){return this.id===void 0&&(this.id=e,!0)}setGroupId(e){return this.groupId===void 0&&(this.groupId=e,!0)}setExtendData(e){return e!==this.extendData&&(this.extendData=e,!0)}setStyles(e){return e!==this.styles&&(this.styles=e,!0)}setPoints(e){if(e.length>0){let t;if(this.points=[...e],e.length>=this.totalStep-1?(this.currentStep=-1,t=this.totalStep-1):(this.currentStep=e.length+1,t=e.length),this.performEventMoveForDrawing!==null)for(let i=0;i<t;i++)this.performEventMoveForDrawing({currentStep:i+2,mode:this.mode,points:this.points,performPointIndex:i,performPoint:this.points[i]});return this.currentStep===-1&&this.performEventPressedMove!==null&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1}setLock(e){return this.lock!==e&&(this.lock=e,!0)}setMode(e){return e!==this.mode&&(this.mode=e,!0)}setOnDrawStartCallback(e){return this.onDrawStart!==e&&(this.onDrawStart=e,!0)}setOnDrawingCallback(e){return this.onDrawing!==e&&(this.onDrawing=e,!0)}setOnDrawEndCallback(e){return this.onDrawEnd!==e&&(this.onDrawEnd=e,!0)}setOnClickCallback(e){return this.onClick!==e&&(this.onClick=e,!0)}setOnRightClickCallback(e){return this.onRightClick!==e&&(this.onRightClick=e,!0)}setOnPressedMoveStartCallback(e){return this.onPressedMoveStart!==e&&(this.onPressedMoveStart=e,!0)}setOnPressedMovingCallback(e){return this.onPressedMoving!==e&&(this.onPressedMoving=e,!0)}setOnPressedMoveEndCallback(e){return this.onPressedMoveEnd!==e&&(this.onPressedMoveEnd=e,!0)}setOnMouseEnterCallback(e){return this.onMouseEnter!==e&&(this.onMouseEnter=e,!0)}setOnMouseLeaveCallback(e){return this.onMouseLeave!==e&&(this.onMouseLeave=e,!0)}setOnRemovedCallback(e){return this.onRemoved!==e&&(this.onRemoved=e,!0)}setOnSelectedCallback(e){return this.onSelected!==e&&(this.onSelected=e,!0)}setOnDeselectedCallback(e){return this.onDeselected!==e&&(this.onDeselected=e,!0)}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=-1:this.currentStep++}isDrawing(){return this.currentStep!==-1}isStart(){return this.currentStep===1}eventMoveForDrawing(e){var t;const i=this.currentStep-1,n={};e.timestamp!==void 0&&(n.timestamp=e.timestamp),e.dataIndex!==void 0&&(n.dataIndex=e.dataIndex),e.value!==void 0&&(n.value=e.value),this.points[i]=n,(t=this.performEventMoveForDrawing)===null||t===void 0||t.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:i,performPoint:n})}eventPressedPointMove(e,t){var i;e.dataIndex!==void 0&&(this.points[t].dataIndex=e.dataIndex,this.points[t].timestamp=e.timestamp),e.value!==void 0&&(this.points[t].value=e.value),(i=this.performEventPressedMove)===null||i===void 0||i.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})}startPressedMove(e){this._prevPressedPoint={...e},this._prevPressedPoints=He(this.points)}eventPressedOtherMove(e,t){if(this._prevPressedPoint!==null){let i,n;e.dataIndex!==void 0&&this._prevPressedPoint.dataIndex!==void 0&&(i=e.dataIndex-this._prevPressedPoint.dataIndex),e.value!==void 0&&this._prevPressedPoint.value!==void 0&&(n=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(s=>{var o;s.dataIndex===void 0&&s.timestamp!==void 0&&(s.dataIndex=t.timestampToDataIndex(s.timestamp));const a={...s};return i!==void 0&&s.dataIndex!==void 0&&(a.dataIndex=s.dataIndex+i,a.timestamp=(o=t.dataIndexToTimestamp(a.dataIndex))!==null&&o!==void 0?o:void 0),n!==void 0&&s.value!==void 0&&(a.value=s.value+n),a})}}static extend(e){return class extends Le{constructor(){super(e)}}}}function ct(r,e){return Math.sqrt(Math.pow(r.x+e.x,2)+Math.pow(r.y+e.y,2))}function oi(r){const e=ct(r[0],r[1]),t=e+ct(r[1],r[2]),i=[r[2].x-r[0].x,r[2].y-r[0].y];return[{x:r[1].x-.5*i[0]*e/t,y:r[1].y-.5*i[1]*e/t},{x:r[1].x+.5*i[0]*e/t,y:r[1].y+.5*i[1]*e/t}]}function ht(r,e){let t=!1;const i=e.coordinates;if(i.length>1)for(let n=1;n<i.length;n++){const s=i[n-1],o=i[n];if(s.x===o.x)t=Math.abs(r.x-s.x)<2;else{const a=Be(s,o),l=Ge(a,r),c=Math.abs(l-r.y);t=c*c/(a[0]*a[0]+1)<4}if(t)return t}return t}function Ge(r,e){return r!=null?e.x*r[0]+r[1]:e.y}function we(r,e,t){return Ge(Be(r,e),t)}function Be(r,e){const t=r.x-e.x;if(t!==0){const i=(r.y-e.y)/t;return[i,r.y-i*r.x]}return null}function ut(r,e,t){const{coordinates:i}=e,n=i.length;if(n>1){const{style:s="solid",smooth:o,size:a=1,color:l="currentColor",dashedValue:c=[2,2]}=t;if(r.lineWidth=a,r.strokeStyle=l,s==="dashed"?r.setLineDash(c):r.setLineDash([]),r.beginPath(),r.moveTo(i[0].x,i[0].y),o!=null&&o){let h=[];for(let d=1;d<n-1;d++)h=h.concat(oi([i[d-1],i[d],i[d+1]]));r.quadraticCurveTo(h[0].x,h[0].y,i[1].x,i[1].y);let u=2;for(;u<n-1;u++)r.bezierCurveTo(h[2*(u-2)+1].x,h[2*(u-2)+1].y,h[2*(u-1)].x,h[2*(u-1)].y,i[u].x,i[u].y);r.quadraticCurveTo(h[2*(u-2)+1].x,h[2*(u-2)+1].y,i[u].x,i[u].y)}else for(let h=1;h<i.length;h++)r.lineTo(i[h].x,i[h].y);r.stroke(),r.closePath()}}const ri={name:"line",checkEventOn:ht,draw:(r,e,t)=>{ut(r,e,t)}};function dt(r,e,t){const i=t??0,n=[];if(r.length>1)if(r[0].x===r[1].x){const o=e.height;if(n.push({coordinates:[{x:r[0].x,y:0},{x:r[0].x,y:o}]}),r.length>2){n.push({coordinates:[{x:r[2].x,y:0},{x:r[2].x,y:o}]});const a=r[0].x-r[2].x;for(let l=0;l<i;l++){const c=a*(l+1);n.push({coordinates:[{x:r[0].x+c,y:0},{x:r[0].x+c,y:o}]})}}}else{const o=e.width,a=Be(r[0],r[1]),l=a[0],c=a[1];if(n.push({coordinates:[{x:0,y:0*l+c},{x:o,y:o*l+c}]}),r.length>2){const h=r[2].y-l*r[2].x;n.push({coordinates:[{x:0,y:0*l+h},{x:o,y:o*l+h}]});const u=c-h;for(let d=0;d<i;d++){const g=c+u*(d+1);n.push({coordinates:[{x:0,y:0*l+g},{x:o,y:o*l+g}]})}}}return n}function ai(r,e){if(r.length>1){let t;return t=r[0].x===r[1].x&&r[0].y!==r[1].y?r[0].y<r[1].y?{x:r[0].x,y:e.height}:{x:r[0].x,y:0}:r[0].x>r[1].x?{x:0,y:we(r[0],r[1],{x:0,y:r[0].y})}:{x:e.width,y:we(r[0],r[1],{x:e.width,y:r[0].y})},{coordinates:[r[0],t]}}return[]}const li={name:"simpleAnnotation",createPointFigures:({overlay:r,coordinates:e})=>{var t;let i;L(r.extendData)&&(i=Pe(r.extendData)?r.extendData(r):(t=r.extendData)!==null&&t!==void 0?t:"");const n=e[0].x,s=e[0].y-6,o=s-50,a=o-5;return[{type:"line",attrs:{coordinates:[{x:n,y:s},{x:n,y:o}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:n,y:o},{x:n-4,y:a},{x:n+4,y:a}]},ignoreEvent:!0},{type:"rectText",attrs:{x:n,y:a,text:i??"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},ci={name:"simpleTag",createPointFigures:({bounding:r,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:r.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({overlay:r,coordinates:e,bounding:t,yAxis:i,precision:n})=>{var s,o;let a,l,c;return(s=i==null?void 0:i.isFromZero())!==null&&s!==void 0&&s?(a="left",l=0):(a="right",l=t.width),L(r.extendData)&&(c=Pe(r.extendData)?r.extendData(r):(o=r.extendData)!==null&&o!==void 0?o:""),L(c)||r.points[0].value===void 0||(c=B(r.points[0].value,n.price)),{type:"rectText",attrs:{x:l,y:e[0].y,text:c??"",align:a,baseline:"middle"}}}},Re={};function gt(r){var e;return(e=Re[r])!==null&&e!==void 0?e:null}function vt(r){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return r!==void 0&&ne(e,r),e}[{name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e,overlay:t,precision:i})=>{const n=t.points;if(r.length>0){const s=[],o=[],l=e.width,c=n[1].value;if(r.length>1&&n[0].value!==void 0&&c!==void 0){const h=[1,.786,.618,.5,.382,.236,0],u=r[0].y-r[1].y,d=n[0].value-c;h.forEach(g=>{const p=r[1].y+u*g,m=(c+d*g).toFixed(i.price);s.push({coordinates:[{x:0,y:p},{x:l,y:p}]}),o.push({x:0,y:p,text:`${m} (${(100*g).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:s},{type:"text",isCheckEvent:!1,attrs:o}]}return[]}},{name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>{const t={x:0,y:r[0].y};return r[1]!==void 0&&r[0].x<r[1].x&&(t.x=e.width),[{type:"line",attrs:{coordinates:[r[0],t]}}]},performEventPressedMove:({points:r,performPoint:e})=>{r[0].value=e.value,r[1].value=e.value},performEventMoveForDrawing:({currentStep:r,points:e,performPoint:t})=>{r===2&&(e[0].value=t.value)}},{name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r})=>{const e=[];return r.length===2&&e.push({coordinates:r}),[{type:"line",attrs:e}]},performEventPressedMove:({points:r,performPoint:e})=>{r[0].value=e.value,r[1].value=e.value},performEventMoveForDrawing:({currentStep:r,points:e,performPoint:t})=>{r===2&&(e[0].value=t.value)}},{name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:r[0].y},{x:e.width,y:r[0].y}]}}]},{name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>[{type:"line",attrs:dt(r,e)}]},{name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>[{type:"line",attrs:dt(r,e,1)}]},{name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e,precision:t,overlay:i})=>{const{value:n=0}=i.points[0];return[{type:"line",attrs:{coordinates:[r[0],{x:e.width,y:r[0].y}]}},{type:"text",isCheck:!1,attrs:{x:r[0].x,y:r[0].y,text:n.toFixed(t.price),baseline:"bottom"}}]}},{name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>[{type:"line",attrs:ai(r,e)}]},{name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r})=>r.length===2?[{type:"line",attrs:{coordinates:r}}]:[]},{name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>r.length===2?r[0].x===r[1].x?[{type:"line",attrs:{coordinates:[{x:r[0].x,y:0},{x:r[0].x,y:e.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:we(r[0],r[1],{x:0,y:r[0].y})},{x:e.width,y:we(r[0],r[1],{x:e.width,y:r[0].y})}]}}]:[]},{name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>{if(r.length===2){const t={x:r[0].x,y:0};return r[0].y<r[1].y&&(t.y=e.height),[{type:"line",attrs:{coordinates:[r[0],t]}}]}return[]},performEventPressedMove:({points:r,performPoint:e})=>{r[0].timestamp=e.timestamp,r[0].dataIndex=e.dataIndex,r[1].timestamp=e.timestamp,r[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:r,points:e,performPoint:t})=>{r===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},{name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r})=>r.length===2?[{type:"line",attrs:{coordinates:r}}]:[],performEventPressedMove:({points:r,performPoint:e})=>{r[0].timestamp=e.timestamp,r[0].dataIndex=e.dataIndex,r[1].timestamp=e.timestamp,r[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:r,points:e,performPoint:t})=>{r===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},{name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:r,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:r[0].x,y:0},{x:r[0].x,y:e.height}]}}]},li,ci].forEach(r=>{Re[r.name]=Le.extend(r)});class je{constructor(){this._children=[],this._callbacks=new Map}registerEvent(e,t){return this._callbacks.set(e,t),this}onEvent(e,t,i){const n=this._callbacks.get(e);return!(n===void 0||!this.checkEventOn(t))&&n(t,i)}checkEventOn(e){for(const t of this._children)if(t.checkEventOn(e))return!0;return!1}dispatchEvent(e,t,i){const n=this._children.length-1;if(n>-1){for(let s=n;s>-1;s--)if(this._children[s].dispatchEvent(e,t,i))return!0}return this.onEvent(e,t,i)}addChild(e){return this._children.push(e),this}clear(){this._children=[]}}const G="main",Q="xAxis",ee="yAxis",Ee="separator";class mt extends je{constructor(e,t){super(),this._bounding=vt(),this._pane=t,this._init(e)}_init(e){if(this._container=U("div",this.getContainerStyle()),this.insertBefore()){const t=e.lastChild;t!==null?e.insertBefore(this._container,t):e.appendChild(this._container)}else e.appendChild(this._container);this.initDom(this._container)}setBounding(e){return ne(this._bounding,e),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}update(e){this.updateImp(e,this._container,this._bounding)}insertBefore(){return!1}}class hi extends mt{constructor(e,t){super(e,t),this._dragFlag=!1,this._dragStartY=0,this._topPaneHeight=0,this._currentPaneHeight=0,this._pressedMouseMoveEvent=function(i,n){let s=0;return function(){const o=Date.now();o-s>(n??20)&&(i.apply(this,arguments),s=o)}}(this._pressedTouchMouseMoveEvent,20),this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return Ee}checkEventOn(){return!0}_mouseDownEvent(e){var t,i;this._dragFlag=!0,this._dragStartY=e.pageY;const n=this.getPane();return this._topPaneHeight=(i=(t=n.getTopPane())===null||t===void 0?void 0:t.getBounding().height)!==null&&i!==void 0?i:0,this._currentPaneHeight=n.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(e){const t=e.pageY-this._dragStartY,i=this.getPane(),n=i.getTopPane(),s=t<0;if(n!==null&&i.getOptions().dragEnabled){let o,a,l,c;s?(o=n,a=i,l=this._topPaneHeight,c=this._currentPaneHeight):(o=i,a=n,l=this._currentPaneHeight,c=this._topPaneHeight);const h=o.getOptions().minHeight;if(l>h){const u=Math.max(l-Math.abs(t),h),d=l-u;o.setBounding({height:u}),a.setBounding({height:c+d});const g=i.getChart();g.getChartStore().getActionStore().execute("onPaneDrag",{paneId:i.getId}),g.adjustPaneViewport(!0,!0,!0,!0,!0)}}return!0}_mouseEnterEvent(){const e=this.getPane();if(e.getOptions().dragEnabled){const t=e.getChart(),i=t.getStyles().separator;this._moveDom.style.background=i.activeBackgroundColor;const n=t.getChartStore();return n.setDragPaneFlag(!0),n.getCrosshairStore().set(),!0}return!1}_mouseLeaveEvent(){return!this._dragFlag&&(this._moveDom.style.background="",this.getPane().getChart().getChartStore().setDragPaneFlag(!1),!0)}getContainerStyle(){return{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}}insertBefore(){return!0}initDom(e){this._moveDom=U("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"}),e.appendChild(this._moveDom)}updateImp(e,t,i){if(e===4||e===2){const n=this.getPane().getChart().getStyles().separator;this._moveDom.style.top=-Math.floor((7-n.size)/2)+"px",this._moveDom.style.height="7px";const s=n.fill;t.style.backgroundColor=n.color,t.style.height=`${n.size}px`,t.style.marginLeft=`${s?0:i.left}px`,t.style.width=s?"100%":`${i.width}px`}}getImage(){const e=this.getPane().getChart().getStyles().separator,t=this.getContainer().offsetWidth,i=e.size,n=U("canvas",{width:`${t}px`,height:`${i}px`,boxSizing:"border-box"}),s=n.getContext("2d"),o=pe(n);return n.width=t*o,n.height=i*o,s.scale(o,o),s.fillStyle=e.color,s.fillRect(this.getBounding().left,0,t,i),n}}const D={CANDLE:"candle_pane",INDICATOR:"indcator_pane_",XAXIS:"xaxis_pane"};class pt{constructor(e,t,i,n,s){this._yAxisWidget=null,this._separatorWidget=null,this._axis=this.createAxisComponent(),this._bounding=vt(),this._options={minHeight:30,dragEnabled:!0,gap:{top:.2,bottom:.1}},this._chart=t,this._id=i,this._topPane=n??null,this._bottomPane=s??null,this._init(e)}_init(e){this._container=e,this._seriesContiainer=U("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._separatorWidget=this.createSeparatorWidget(e);const t=e.lastChild;t!==null?e.insertBefore(this._seriesContiainer,t):e.appendChild(this._seriesContiainer),this._mainWidget=this.createMainWidget(this._seriesContiainer),this._yAxisWidget=this.creatYAxisWidget(this._seriesContiainer)}getContainer(){return this._seriesContiainer}getId(){return this._id}setOptions(e){return ne(this._options,e),this}getOptions(){return this._options}getChart(){return this._chart}getAxisComponent(){return this._axis}setBounding(e,t,i){var n,s,o;ne(this._bounding,e);let a=0;if(this._separatorWidget!==null){a=this._chart.getStyles().separator.size;const c={...e,height:7};e.top!==void 0&&(c.top=e.top-Math.floor((7-a)/2)),this._separatorWidget.setBounding(c)}const l={};return e.height!==void 0&&(l.height=e.height-a),e.top!==void 0&&(l.top=e.top+a),this._mainWidget.setBounding(l),(n=this._yAxisWidget)===null||n===void 0||n.setBounding(l),t!==void 0&&(this._mainWidget.setBounding(t),(s=this._separatorWidget)===null||s===void 0||s.setBounding(t)),i!==void 0&&((o=this._yAxisWidget)===null||o===void 0||o.setBounding(i)),this}getTopPane(){return this._topPane}setTopPane(e){return this._topPane=e,this}getBottomPane(){return this._bottomPane}setBottomPane(e){return this._bottomPane=e,this}getBounding(){return this._bounding}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}getSeparatorWidget(){return this._separatorWidget}update(e){var t,i;this._bounding.width!==this._seriesContiainer.offsetWidth&&(this._seriesContiainer.style.width=`${this._bounding.width}px`);const n=this._mainWidget.getBounding().height;n!==this._seriesContiainer.offsetHeight&&(this._seriesContiainer.style.height=`${n}px`);const s=e??3;this._mainWidget.update(s),(t=this._yAxisWidget)===null||t===void 0||t.update(s),(i=this._separatorWidget)===null||i===void 0||i.update(s)}getImage(e){const{width:t,height:i}=this._bounding,n=U("canvas",{width:`${t}px`,height:`${i}px`,boxSizing:"border-box"}),s=n.getContext("2d"),o=pe(n);n.width=t*o,n.height=i*o,s.scale(o,o);let a=0;if(this._separatorWidget!=null){const c=this.getChart().getStyles().separator.size;a=c,s.drawImage(this._separatorWidget.getImage(),0,0,t,c)}const l=this._mainWidget.getBounding();if(s.drawImage(this._mainWidget.getImage(e),l.left,a,l.width,l.height),this._yAxisWidget!==null){const c=this._yAxisWidget.getBounding();s.drawImage(this._yAxisWidget.getImage(e),c.left,a,c.width,c.height)}return n}destroy(){this._container.removeChild(this._seriesContiainer),this._separatorWidget!==null&&this._container.removeChild(this._separatorWidget.getContainer())}createSeparatorWidget(e){return null}creatYAxisWidget(e){return null}}class ui{constructor(e){this._instances=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._chartStore=e}_overrideInstance(e,t){const{id:i,groupId:n,points:s,styles:o,lock:a,mode:l,extendData:c,onDrawStart:h,onDrawing:u,onDrawEnd:d,onClick:g,onRightClick:p,onPressedMoveStart:m,onPressedMoving:v,onPressedMoveEnd:_,onMouseEnter:x,onMouseLeave:f,onRemoved:y,onSelected:S,onDeselected:b}=t;let C=!1;return i!==void 0&&e.setId(i),n!==void 0&&e.setGroupId(n),s!==void 0&&e.setPoints(s)&&(C=!0),o!==void 0&&e.setStyles(o)&&(C=!0),a!==void 0&&e.setLock(a),l!==void 0&&e.setMode(l),c!==void 0&&e.setExtendData(c)&&(C=!0),h!==void 0&&e.setOnDrawStartCallback(h),u!==void 0&&e.setOnDrawingCallback(u),d!==void 0&&e.setOnDrawEndCallback(d),g!==void 0&&e.setOnClickCallback(g),p!==void 0&&e.setOnRightClickCallback(p),m!==void 0&&e.setOnPressedMoveStartCallback(m),v!==void 0&&e.setOnPressedMovingCallback(v),_!==void 0&&e.setOnPressedMoveEndCallback(_),x!==void 0&&e.setOnMouseEnterCallback(x),f!==void 0&&e.setOnMouseLeaveCallback(f),y!==void 0&&e.setOnRemovedCallback(y),S!==void 0&&e.setOnSelectedCallback(S),b!==void 0&&e.setOnDeselectedCallback(b),C}getInstanceById(e){for(const t of this._instances){const i=t[1].find(n=>n.id===e);if(i!==void 0)return i}return this._progressInstanceInfo!==null&&this._progressInstanceInfo.instance.id===e?this._progressInstanceInfo.instance:null}addInstance(e,t,i){var n,s,o,a;const l=(n=e.id)!==null&&n!==void 0?n:ue("overlay_");if(this.getInstanceById(l)===null){const c=new(gt(e.name)),h=(s=e.groupId)!==null&&s!==void 0?s:l;return e.id=l,e.groupId=h,this._overrideInstance(c,e),c.isDrawing()?this._progressInstanceInfo={paneId:t,instance:c,appointPaneFlag:i}:(this._instances.has(t)||this._instances.set(t,[]),(o=this._instances.get(t))===null||o===void 0||o.push(c)),(a=c.onDrawStart)===null||a===void 0||a.call(c,{overlay:c}),this._chartStore.getChart().updatePane(1,t),l}return null}getProgressInstanceInfo(){return this._progressInstanceInfo}progressInstanceComplete(){var e;if(this._progressInstanceInfo!==null){const{instance:t,paneId:i}=this._progressInstanceInfo;t.isDrawing()||(this._instances.has(i)||this._instances.set(i,[]),(e=this._instances.get(i))===null||e===void 0||e.push(t),this._progressInstanceInfo=null)}}updateProgressInstanceInfo(e,t){this._progressInstanceInfo!==null&&(t!==void 0&&t&&(this._progressInstanceInfo.appointPaneFlag=t),this._progressInstanceInfo.paneId=e)}getInstances(e){var t;if(e===void 0){let i=[];return this._instances.forEach(n=>{i=i.concat(n)}),i}return(t=this._instances.get(e))!==null&&t!==void 0?t:[]}override(e){const{id:t,groupId:i,name:n}=e;let s=!1;if(t!==void 0){const o=this.getInstanceById(t);o!==null&&this._overrideInstance(o,e)&&(s=!0)}else if(this._instances.forEach(o=>{o.forEach(a=>{(n!==void 0&&a.name===n||i!==void 0&&a.groupId===i||n===void 0&&i===void 0)&&this._overrideInstance(a,e)&&(s=!0)})}),this._progressInstanceInfo!==null){const o=this._progressInstanceInfo.instance;(n!==void 0&&o.name===n||i!==void 0&&o.groupId===i||n===void 0&&i===void 0)&&this._overrideInstance(o,e)&&(s=!0)}s&&this._chartStore.getChart().updatePane(1)}removeInstance(e){var t;const i=(s,o)=>{if(s.id!==void 0){if(o.id!==s.id)return!1}else if(s.groupId!==void 0){if(o.groupId!==s.groupId)return!1}else if(s.name!==void 0&&o.name!==s.name)return!1;return!0},n=[];if(this._progressInstanceInfo!==null){const s=this._progressInstanceInfo.instance;(e===void 0||e!==void 0&&i(e,s))&&(n.push(this._progressInstanceInfo.paneId),(t=s.onRemoved)===null||t===void 0||t.call(s,{overlay:s}),this._progressInstanceInfo=null)}if(e!==void 0){const s=new Map;for(const o of this._instances){const a=o[1].filter(l=>{var c;return!i(e,l)||(n.includes(o[0])||n.push(o[0]),(c=l.onRemoved)===null||c===void 0||c.call(l,{overlay:l}),!1)});a.length>0&&s.set(o[0],a)}this._instances=s}else this._instances.forEach((s,o)=>{n.push(o),s.forEach(a=>{var l;(l=a.onRemoved)===null||l===void 0||l.call(a,{overlay:a})})}),this._instances.clear();if(n.length>0){const s=this._chartStore.getChart();n.forEach(o=>{s.updatePane(1,o)}),s.updatePane(1,D.XAXIS)}}setPressedInstanceInfo(e){this._pressedInstanceInfo=e}getPressedInstanceInfo(){return this._pressedInstanceInfo}setHoverInstanceInfo(e,t){var i,n,s,o,a;const{instance:l,figureType:c,figureIndex:h}=this._hoverInstanceInfo;(l==null?void 0:l.id)===((i=e.instance)===null||i===void 0?void 0:i.id)&&c===e.figureType&&h===e.figureIndex||(this._hoverInstanceInfo=e,(l==null?void 0:l.id)!==((n=e.instance)===null||n===void 0?void 0:n.id)&&((s=l==null?void 0:l.onMouseLeave)===null||s===void 0||s.call(l,{overlay:l,...t}),(a=(o=e.instance)===null||o===void 0?void 0:o.onMouseEnter)===null||a===void 0||a.call(o,{overlay:e.instance,...t})))}getHoverInstanceInfo(){return this._hoverInstanceInfo}setClickInstanceInfo(e,t){var i,n,s,o,a,l,c,h,u;const{paneId:d,instance:g,figureType:p,figureIndex:m}=this._clickInstanceInfo;if((n=(i=e.instance)===null||i===void 0?void 0:i.isDrawing())!==null&&n!==void 0&&n||(o=(s=e.instance)===null||s===void 0?void 0:s.onClick)===null||o===void 0||o.call(s,{overlay:e.instance,...t}),((g==null?void 0:g.id)!==((a=e.instance)===null||a===void 0?void 0:a.id)||p!==e.figureType||m!==e.figureIndex)&&(this._clickInstanceInfo=e,(g==null?void 0:g.id)!==((l=e.instance)===null||l===void 0?void 0:l.id))){(c=g==null?void 0:g.onDeselected)===null||c===void 0||c.call(g,{overlay:g,...t}),(u=(h=e.instance)===null||h===void 0?void 0:h.onSelected)===null||u===void 0||u.call(h,{overlay:e.instance,...t});const v=this._chartStore.getChart();v.updatePane(1,e.paneId),d!==e.paneId&&v.updatePane(1,d),v.updatePane(1,D.XAXIS)}}getClickInstanceInfo(){return this._clickInstanceInfo}isEmpty(){return this._instances.size===0&&this._progressInstanceInfo===null}isDrawing(){var e,t;return this._progressInstanceInfo!==null&&(t=(e=this._progressInstanceInfo)===null||e===void 0?void 0:e.instance.isDrawing())!==null&&t!==void 0&&t}}class di{constructor(){this._callbacks=[]}subscribe(e){var t;((t=this._callbacks.indexOf(e))!==null&&t!==void 0?t:-1)<0&&this._callbacks.push(e)}unsubscribe(e){var t;if(e!==void 0){const i=(t=this._callbacks.indexOf(e))!==null&&t!==void 0?t:-1;i>-1&&this._callbacks.splice(i,1)}else this._callbacks=[]}execute(e){this._callbacks.forEach(t=>{t(e)})}isEmpty(){return this._callbacks.length===0}}class gi{constructor(){this._actions=new Map}execute(e,t){var i;(i=this._actions.get(e))===null||i===void 0||i.execute(t)}subscribe(e,t){var i;this._actions.has(e)||this._actions.set(e,new di),(i=this._actions.get(e))===null||i===void 0||i.subscribe(t)}unsubscribe(e,t){const i=this._actions.get(e);i!==void 0&&(i.unsubscribe(t),i.isEmpty()&&this._actions.delete(e))}has(e){const t=this._actions.get(e);return t!==void 0&&!t.isEmpty()}}const _t={light:{grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},dark:{grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}}};function xt(r){var e;return(e=_t[r])!==null&&e!==void 0?e:null}class vi{constructor(e,t){this._styles={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}},candle:{type:"candle_solid",bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#1677FF",value:"close",backgroundColor:[{offset:0,color:"rgba(22, 119, 255, 0.01)"},{offset:1,color:"rgba(22, 119, 255, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:"always",showType:"standard",custom:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},indicator:{ohlc:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lines:[{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#FF9600"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#9D65C9"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#1677FF"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#E11D74"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#01C5C4"}],circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{showRule:"always",showType:"standard",showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,size:"auto",type:"normal",position:"right",inside:!1,reverse:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:"#686D76",borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#686D76",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}}},overlay:{point:{color:"#1677FF",borderColor:"rgba(22, 119, 255, 0.35)",borderSize:1,radius:5,activeColor:"#1677FF",activeBorderColor:"rgba(22, 119, 255, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:"#1677FF",size:1,dashedValue:[2,2]},rect:{style:"fill",color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:"#1677FF",borderColor:"#1677FF",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:"#1677FF",size:1,dashedValue:[2,2]},text:{color:"#1677FF",size:12,family:"Helvetica Neue",weight:"normal"},rectText:{style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#1677FF",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#1677FF"}}},this._customApi={formatDate:st,formatBigNumber:ot},this._locale="en-US",this._precision={price:2,volume:0},this._dataList=[],this._dragPaneFlag=!1,this._timeScaleStore=new Jt(this),this._indicatorStore=new ni(this),this._overlayStore=new ui(this),this._crosshairStore=new si(this),this._actionStore=new gi,this._visibleDataList=[],this._chart=e,this.setOptions(t)}adjustVisibleDataList(){this._visibleDataList=[];const{from:e,to:t}=this._timeScaleStore.getVisibleRange();for(let i=e;i<t;i++){const n=this._dataList[i],s=this._timeScaleStore.dataIndexToCoordinate(i);this._visibleDataList.push({dataIndex:i,x:s,data:n})}}setOptions(e){if(e!==void 0){const{locale:t,timezone:i,styles:n,customApi:s}=e;t!==void 0&&(this._locale=t),i!==void 0&&this._timeScaleStore.setTimezone(i),n!==void 0&&(ae(n)?ne(this._styles,xt(n)):ne(this._styles,n)),s!==void 0&&ne(this._customApi,s)}return this}getStyles(){return this._styles}getLocale(){return this._locale}getCustomApi(){return this._customApi}getPrecision(){return this._precision}setPrecision(e){return this._precision=e,this._indicatorStore.setSeriesPrecision(e),this}getDataList(){return this._dataList}getVisibleDataList(){return this._visibleDataList}addData(e,t,i){if(se(e)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(i==null||i);const n=this._dataList.length===0;this._dataList=e.concat(this._dataList),n&&this._timeScaleStore.resetOffsetRightDistance(),this._timeScaleStore.adjustVisibleRange()}else if(t>=this._dataList.length){this._dataList.push(e);let n=this._timeScaleStore.getOffsetRightBarCount();n<0&&this._timeScaleStore.setOffsetRightBarCount(--n),this._timeScaleStore.adjustVisibleRange()}else this._dataList[t]=e,this.adjustVisibleDataList();this._crosshairStore.recalculate(!0)}clearDataList(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}getTimeScaleStore(){return this._timeScaleStore}getIndicatorStore(){return this._indicatorStore}getOverlayStore(){return this._overlayStore}getCrosshairStore(){return this._crosshairStore}getActionStore(){return this._actionStore}getChart(){return this._chart}getDragPaneFlag(){return this._dragPaneFlag}setDragPaneFlag(e){return this._dragPaneFlag=e,this}}function ft(r){return window.requestAnimationFrame==null?window.setTimeout(r,20):window.requestAnimationFrame(r)}function yt(r){window.cancelAnimationFrame==null&&window.clearTimeout(r),window.cancelAnimationFrame(r)}const _e=-1;class Ue extends mt{constructor(){super(...arguments),this._mainRequestAnimationId=_e,this._overlayRequestAnimationId=_e}getContainerStyle(){return{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}}initDom(e){this._mainCanvas=U("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._mainCtx=this._mainCanvas.getContext("2d"),this._overlayCanvas=U("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._overlayCtx=this._overlayCanvas.getContext("2d"),e.appendChild(this._mainCanvas),e.appendChild(this._overlayCanvas)}_optimalUpdateMain(){this._mainRequestAnimationId!==_e&&(yt(this._mainRequestAnimationId),this._mainRequestAnimationId=_e),this._mainRequestAnimationId=ft(()=>{this.updateMain(this._mainCtx)})}_optimalUpdateOverlay(){this._overlayRequestAnimationId!==_e&&(yt(this._overlayRequestAnimationId),this._overlayRequestAnimationId=_e),this._overlayRequestAnimationId=ft(()=>{this.updateOverlay(this._overlayCtx)})}updateImp(e,t,i){const{width:n,height:s,left:o}=i;t.style.left=`${o}px`;let a=e;if(n!==t.offsetWidth||s!==t.offsetHeight){this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);const l=`${n}px`,c=`${s}px`;t.style.width=l,t.style.height=c;const h=pe(this._mainCanvas),u=Math.floor(n*h),d=Math.floor(s*h);this._mainCanvas.style.width=l,this._mainCanvas.style.height=c,this._mainCanvas.width=u,this._mainCanvas.height=d,this._mainCtx.scale(h,h),this._overlayCanvas.style.width=l,this._overlayCanvas.style.height=c,this._overlayCanvas.width=u,this._overlayCanvas.height=d,this._overlayCtx.scale(h,h),a=3}else a!==4&&a!==3&&a!==0||this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),a!==4&&a!==3&&a!==1||this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);switch(a){case 0:this._optimalUpdateMain();break;case 1:this._optimalUpdateOverlay();break;case 3:case 4:this._optimalUpdateMain(),this._optimalUpdateOverlay()}}getImage(e){const{width:t,height:i}=this.getBounding(),n=U("canvas",{width:`${t}px`,height:`${i}px`,boxSizing:"border-box"}),s=n.getContext("2d"),o=pe(n);return n.width=t*o,n.height=i*o,s.scale(o,o),s.drawImage(this._mainCanvas,0,0,t,i),e&&s.drawImage(this._overlayCanvas,0,0,t,i),n}}const Ie=2;class Ne extends je{constructor(e){super(),this.attrs=e.attrs,this.styles=e.styles}checkEventOn(e){return this.checkEventOnImp(e,this.attrs,this.styles)}draw(e){this.drawImp(e,this.attrs,this.styles)}static extend(e){return class extends Ne{checkEventOnImp(t,i,n){return e.checkEventOn(t,i,n)}drawImp(t,i,n){e.draw(t,i,n)}}}}function St(r,e){const t=r.x-e.x,i=r.y-e.y,n=e.r;return!(t*t+i*i>n*n)}function Ct(r,e,t){const{x:i,y:n,r:s}=e,{style:o="fill",color:a="currentColor",borderSize:l=1,borderColor:c="currentColor",borderStyle:h="solid",borderDashedValue:u=[2,2]}=t;o!=="fill"&&t.style!=="stroke_fill"||(r.fillStyle=a,r.beginPath(),r.arc(i,n,s,0,2*Math.PI),r.closePath(),r.fill()),o!=="stroke"&&t.style!=="stroke_fill"||(r.strokeStyle=c,r.lineWidth=l,h==="dashed"?r.setLineDash(u):r.setLineDash([]),r.beginPath(),r.arc(i,n,s,0,2*Math.PI),r.closePath(),r.stroke())}const mi={name:"circle",checkEventOn:St,draw:(r,e,t)=>{Ct(r,e,t)}};function bt(r,e){let t=!1;const i=e.coordinates;for(let n=0,s=i.length-1;n<i.length;s=n++)i[n].y>r.y!=i[s].y>r.y&&r.x<(i[s].x-i[n].x)*(r.y-i[n].y)/(i[s].y-i[n].y)+i[n].x&&(t=!t);return t}function wt(r,e,t){const{coordinates:i}=e,{style:n="fill",color:s="currentColor",borderSize:o=1,borderColor:a="currentColor",borderStyle:l="solid",borderDashedValue:c=[2,2]}=t;if(n==="fill"||t.style==="stroke_fill"){r.fillStyle=s,r.beginPath(),r.moveTo(i[0].x,i[0].y);for(let h=1;h<i.length;h++)r.lineTo(i[h].x,i[h].y);r.closePath(),r.fill()}if(n==="stroke"||t.style==="stroke_fill"){r.strokeStyle=a,r.lineWidth=o,l==="dashed"?r.setLineDash(c):r.setLineDash([]),r.beginPath(),r.moveTo(i[0].x,i[0].y);for(let h=1;h<i.length;h++)r.lineTo(i[h].x,i[h].y);r.closePath(),r.stroke()}}const pi={name:"polygon",checkEventOn:bt,draw:(r,e,t)=>{wt(r,e,t)}};function Et(r,e){return r.x>=e.x&&r.x<=e.x+e.width&&r.y>=e.y&&r.y<=e.y+e.height}function Ze(r,e,t){const{x:i,y:n,width:s,height:o}=e,{style:a="fill",color:l="currentColor",borderSize:c=1,borderColor:h="currentColor",borderStyle:u="solid",borderRadius:d=0,borderDashedValue:g=[2,2]}=t;a!=="fill"&&t.style!=="stroke_fill"||(r.fillStyle=l,r.beginPath(),r.moveTo(i+d,n),r.arcTo(i+s,n,i+s,n+o,d),r.arcTo(i+s,n+o,i,n+o,d),r.arcTo(i,n+o,i,n,d),r.arcTo(i,n,i+s,n,d),r.closePath(),r.fill()),a!=="stroke"&&t.style!=="stroke_fill"||(r.strokeStyle=h,r.lineWidth=c,u==="dashed"?r.setLineDash(g):r.setLineDash([]),r.beginPath(),r.moveTo(i+d,n),r.arcTo(i+s,n,i+s,n+o,d),r.arcTo(i+s,n+o,i,n+o,d),r.arcTo(i,n+o,i,n,d),r.arcTo(i,n,i+s,n,d),r.closePath(),r.stroke())}const _i={name:"rect",checkEventOn:Et,draw:(r,e,t)=>{Ze(r,e,t)}};function It(r,e,t){const{size:i=12,paddingLeft:n=0,paddingTop:s=0,paddingRight:o=0,paddingBottom:a=0}=e,{x:l,y:c,text:h,align:u="left",baseline:d="top"}=r,g=h.length;t=t??i*g;const p=i;let m,v;switch(u){case"left":case"start":m=l;break;case"right":case"end":m=l-o-t-n;break;default:m=l-t/2-n}switch(d){case"top":case"hanging":v=c;break;case"bottom":case"ideographic":case"alphabetic":v=c-p-s-a;break;default:v=c-p/2-s}return{x:m,y:v,width:n+t+o,height:s+p+a}}function qe(r,e,t){const{x:i,y:n,width:s,height:o}=It(e,t);return r.x>=i&&r.x<=i+s&&r.y>=n&&r.y<=n+o}function Ke(r,e,t){const{x:i,y:n,text:s,align:o="left",baseline:a="top"}=e,{color:l="currentColor",size:c=12,family:h,weight:u}=t;r.textAlign=o,r.textBaseline=a,r.font=re(c,u,h),r.fillStyle=l,r.fillText(s,i,n)}const xi={name:"text",checkEventOn:(r,e,t)=>qe(r,e,t),draw:(r,e,t)=>{Ke(r,e,t)}};function Tt(r,e,t){const{text:i}=e,{size:n=12,family:s,weight:o,paddingLeft:a=0,paddingTop:l=0}=t;r.font=re(n,o,s);const c=It(e,t,r.measureText(i).width);Ze(r,c,{...t,color:t.backgroundColor}),Ke(r,{x:c.x+a,y:c.y+l,text:i,align:"left",baseline:"top"},t)}const fi={name:"rectText",checkEventOn:(r,e,t)=>qe(r,e,t),draw:(r,e,t)=>{Tt(r,e,t)}},Te={};[mi,ri,pi,_i,xi,fi].forEach(r=>{Te[r.name]=Ne.extend(r)});class te extends je{constructor(e){super(),this._widget=e}getWidget(){return this._widget}createFigure(e,t,i,n){const s=function(o){var a;return(a=Te[o])!==null&&a!==void 0?a:null}(e);if(s!==null){const o=new s({name:e,attrs:t,styles:i});if(n!==void 0){for(const a in n)n.hasOwnProperty(a)&&o.registerEvent(a,n[a]);this.addChild(o)}return o}return null}draw(e){this.clear(),this.drawImp(e)}}class yi extends te{drawImp(e){var t;const i=this.getWidget(),n=this.getWidget().getPane(),s=n.getChart(),o=i.getBounding(),a=s.getStyles().grid;if(a.show){e.save(),e.globalCompositeOperation="destination-over";const l=a.horizontal;l.show&&((t=s.getPaneById(D.XAXIS))===null||t===void 0?void 0:t.getAxisComponent()).getTicks().forEach(h=>{var u;(u=this.createFigure("line",{coordinates:[{x:h.coord,y:0},{x:h.coord,y:o.height}]},l))===null||u===void 0||u.draw(e)});const c=a.vertical;c.show&&n.getAxisComponent().getTicks().forEach(h=>{var u;(u=this.createFigure("line",{coordinates:[{x:0,y:h.coord},{x:o.width,y:h.coord}]},c))===null||u===void 0||u.draw(e)}),e.restore()}}}class Je extends te{eachChildren(e){const t=this.getWidget().getPane().getChart().getChartStore(),i=t.getVisibleDataList(),n=t.getTimeScaleStore().getBarSpace();i.forEach((s,o)=>{e(s,n,o)})}}class Dt extends Je{drawImp(e){const t=this.getWidget().getPane(),i=t.getChart().getChartStore(),n=this.getCandleBarOptions(i);if(n!==null){const s=t.getAxisComponent();this.eachChildren((o,a)=>{this._drawCandleBar(e,s,o,a,n)})}}getCandleBarOptions(e){const t=e.getStyles().candle;return{type:t.type,styles:t.bar}}_drawCandleBar(e,t,i,n,s){const{data:o,x:a}=i,{open:l,high:c,low:h,close:u}=o,{halfGapBar:d,gapBar:g}=n,{type:p,styles:m}=s;let v;v=u>l?m.upColor:u<l?m.downColor:m.noChangeColor;const _=t.convertToPixel(l),x=t.convertToPixel(u),f=[_,x,t.convertToPixel(c),t.convertToPixel(h)];f.sort((b,C)=>b-C);const y=Math.max(1,f[2]-f[1]);let S=[];p!=="ohlc"?(S.push({name:"rect",attrs:{x:a-.5,y:f[0],width:1,height:f[1]-f[0]},styles:{color:v}}),p==="candle_stroke"||p==="candle_up_stroke"&&l<u||p==="candle_down_stroke"&&l>u?S.push({name:"rect",attrs:{x:a-d+.5,y:f[1],width:g-1,height:y},styles:{style:"stroke",borderColor:v}}):S.push({name:"rect",attrs:{x:a-d,y:f[1],width:g,height:y},styles:{color:v}}),S.push({name:"rect",attrs:{x:a-.5,y:f[2],width:1,height:f[3]-f[2]},styles:{color:v}})):S=[{name:"rect",attrs:{x:a-.5,y:f[0],width:1,height:f[3]-f[0]},styles:{color:v}},{name:"rect",attrs:{x:a-d,y:_,width:d,height:1},styles:{color:v}},{name:"rect",attrs:{x:a,y:x,width:d,height:1},styles:{color:v}}],S.forEach(({attrs:b,styles:C})=>{var w;(w=this.createFigure("rect",b,C))===null||w===void 0||w.draw(e)})}}class Si extends Dt{getCandleBarOptions(e){const t=this.getWidget().getPane();if(!t.getAxisComponent().isInCandle()){const i=e.getIndicatorStore().getInstances(t.getId());for(const n of i){const s=n[1];if(s.shouldOhlc){const o=s.styles,a=e.getStyles().indicator;return{type:"ohlc",styles:{upColor:A(o,"ohlc.upColor",a.ohlc.upColor),downColor:A(o,"ohlc.downColor",a.ohlc.downColor),noChangeColor:A(o,"ohlc.noChangeColor",a.ohlc.noChangeColor)}}}}}return null}drawImp(e){var t;super.drawImp(e);const i=this.getWidget(),n=i.getPane(),s=n.getChart(),o=i.getBounding(),a=(t=s.getPaneById(D.XAXIS))===null||t===void 0?void 0:t.getAxisComponent(),l=n.getAxisComponent(),c=s.getChartStore(),h=c.getDataList(),u=c.getTimeScaleStore(),d=u.getVisibleRange(),g=c.getIndicatorStore().getInstances(n.getId()),p=c.getStyles().indicator;g.forEach(m=>{var v;let _=!1;if(m.draw!==null&&(e.save(),_=(v=m.draw({ctx:e,kLineDataList:h,indicator:m,visibleRange:d,bounding:o,barSpace:u.getBarSpace(),defaultStyles:p,xAxis:a,yAxis:l}))!==null&&v!==void 0&&v,e.restore()),!_){const x=m.result,f=[],y=[],S=[];this.eachChildren((b,C)=>{var w;const{halfGapBar:T,gapBar:I}=C,{dataIndex:k,x:O}=b,Y=(w=x[k])!==null&&w!==void 0?w:{};$e(h,m,k,p,(R,P,j,E)=>{var z,J,N;const ie=Y[R.key],oe=l.convertToPixel(ie);switch(R.type){case"circle":L(ie)&&((z=this.createFigure("circle",{x:O,y:oe,r:T},{style:P.style,color:P.color,borderColor:P.color}))===null||z===void 0||z.draw(e));break;case"bar":if(L(ie)){const le=(J=R.baseValue)!==null&&J!==void 0?J:l.getExtremum().min,W=l.convertToPixel(le),H=Math.abs(W-oe);let ce;ce=oe>W?W:H<1?W-1:oe,(N=this.createFigure("rect",{x:O-T,y:ce,width:I,height:H},{style:P.style,color:P.color,borderColor:P.color}))===null||N===void 0||N.draw(e)}break;case"line":{let le=null;if(L(ie)){le=P;const W={x:O,y:oe},H=f[E];L(y[E])||(y[E]=[]),y[E].push(W),L(H)&&((H==null?void 0:H.color)!==P.color||(H==null?void 0:H.style)!==P.style)&&(S.push({name:"line",attrs:{coordinates:y[E]},styles:{style:P.style,color:P.color,size:j.size,smooth:j.smooth,dashedValue:j.dashedValue}}),y[E]=[W]),k===d.to-1&&S.push({name:"line",attrs:{coordinates:y[E]},styles:{style:P.style,color:P==null?void 0:P.color,size:j.size,smooth:j.smooth,dashedValue:j.dashedValue}})}f[E]=le;break}}})}),S.forEach(({attrs:b,styles:C})=>{var w;(w=this.createFigure("line",b,C))===null||w===void 0||w.draw(e)})}})}}class Ci extends te{drawImp(e){const t=this.getWidget(),i=t.getPane(),n=t.getBounding(),s=t.getPane().getChart().getChartStore(),o=s.getCrosshairStore().get(),a=s.getStyles().crosshair;if(o.paneId!==void 0&&a.show){if(o.paneId===i.getId()){const c=o.y;this._drawLine(e,[{x:0,y:c},{x:n.width,y:c}],a.horizontal)}const l=o.realX;this._drawLine(e,[{x:l,y:0},{x:l,y:n.height}],a.horizontal)}}_drawLine(e,t,i){var n;if(i.show){const s=i.line;s.show&&((n=this.createFigure("line",{coordinates:t},s))===null||n===void 0||n.draw(e))}}}class Mt extends te{drawImp(e){const t=this.getWidget(),i=t.getPane(),n=i.getChart().getChartStore(),s=n.getCrosshairStore().get();if(s.kLineData!==void 0){const o=t.getBounding(),a=n.getCustomApi(),l=n.getIndicatorStore().getInstances(i.getId()),c=n.getStyles().indicator;this.drawIndicatorTooltip(e,n.getDataList(),s,l,a,o,c)}}drawIndicatorTooltip(e,t,i,n,s,o,a,l){const c=a.tooltip;let h=0;if(this.isDrawTooltip(i,c)){const u=c.text,d=u.marginLeft,g=u.marginRight,p=u.size,m=u.weight,v=u.family;let _=l??0;e.font=re(p,m,v),n.forEach(x=>{var f;const{name:y,calcParamsText:S,values:b}=this.getIndicatorTooltipData(t,i,x,s,a),C=y!==void 0&&y.length>0,w=b!==void 0&&b.length>0;let T=0;if(C||w){if(_+=u.marginTop,h+=u.marginTop+p+u.marginBottom,C&&c.showName){T+=d;let I=y;S!==void 0&&S.length>0&&c.showParams&&(I=`${I}${S}`),(f=this.createFigure("text",{x:T,y:_,text:I},{color:u.color,size:p,family:v,weight:m}))===null||f===void 0||f.draw(e),T+=e.measureText(I).width+g}if(w){const I=this.drawStandardTooltip(e,o,b,T,_,u);h+=I,_+=I}_+=p+u.marginBottom}})}return h}drawStandardTooltip(e,t,i,n,s,o){let a=n,l=s,c=0;const{marginLeft:h,marginTop:u,marginRight:d,marginBottom:g,size:p,family:m,weight:v}=o;return e.font=re(p,v,m),i.forEach((_,x)=>{var f,y;const S=_.title,b=_.value,C=e.measureText(S.text).width,w=e.measureText(b.text).width;a+h+(C+w)+d>t.width?(a=h,c+=p+u+g,l+=p+u+g):a+=h,(f=this.createFigure("text",{x:a,y:l,text:S.text},{color:S.color,size:p,family:m,weight:v}))===null||f===void 0||f.draw(e),a+=C,(y=this.createFigure("text",{x:a,y:l,text:b.text},{color:b.color,size:p,family:m,weight:v}))===null||y===void 0||y.draw(e),a+=w+d}),c}isDrawTooltip(e,t){const i=t.showRule;return i==="always"||i==="follow_cross"&&e.paneId!==void 0}getIndicatorTooltipData(e,t,i,n,s){var o,a,l;if(i.createTooltipDataSource!==null){const m=this.getWidget(),v=m.getPane(),_=v.getChart().getChartStore(),x=i.createTooltipDataSource({kLineDataList:e,indicator:i,visibleRange:_.getTimeScaleStore().getVisibleRange(),bounding:m.getBounding(),crosshair:t,defaultStyles:s,xAxis:(o=v.getChart().getPaneById(D.XAXIS))===null||o===void 0?void 0:o.getAxisComponent(),yAxis:v.getAxisComponent()});if(x.values!==void 0){const f=[],y=s.tooltip.text.color;x.values.forEach(S=>{let b={text:"",color:y};K(S.title)?b=S.title:b.text=S.title;let C={text:"",color:y};K(S.value)?C=S.value:C.text=S.value,f.push({title:b,value:C})}),x.values=f}return x}const c=t.dataIndex,h=(a=i.result)!==null&&a!==void 0?a:[];let u="";const d=i.calcParams;d.length>0&&(u=`(${d.join(",")})`);const g=(l=h[c])!==null&&l!==void 0?l:{},p=[];return $e(e,i,c,s,(m,v)=>{if(m.title!==void 0){const _=v.color;let x=g[m.key];L(x)&&(x=B(x,i.precision),i.shouldFormatBigNumber&&(x=n.formatBigNumber(x))),p.push({title:{text:m.title,color:_},value:{text:x??s.tooltip.defaultValue,color:_}})}}),{name:i.shortName,calcParamsText:u,values:p}}}class Pt extends te{constructor(e){super(e),this._initEvent()}_initEvent(){const e=this.getWidget().getPane(),t=e.getId(),i=e.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",n=>{var s;const o=i.getProgressInstanceInfo();if(o!==null){const a=o.instance;let l=o.paneId;return a.isStart()&&(i.updateProgressInstanceInfo(t),l=t),a.isDrawing()&&l===t&&(a.eventMoveForDrawing(this._coordinateToPoint(o.instance,n)),(s=a.onDrawing)===null||s===void 0||s.call(a,{overlay:a,...n})),this._figureMouseMoveEvent(o.instance,"point",o.instance.points.length-1,0)(n)}return i.setHoverInstanceInfo({paneId:t,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},n),!1}).registerEvent("mouseDownEvent",n=>{var s,o;const a=i.getProgressInstanceInfo();if(a!==null){const l=a.instance;let c=a.paneId;return l.isStart()&&(i.updateProgressInstanceInfo(t,!0),c=t),l.isDrawing()&&c===t&&(l.eventMoveForDrawing(this._coordinateToPoint(l,n)),(s=l.onDrawing)===null||s===void 0||s.call(l,{overlay:l,...n}),l.nextStep(),l.isDrawing()||(i.progressInstanceComplete(),(o=l.onDrawEnd)===null||o===void 0||o.call(l,{overlay:l,...n}))),this._figureMouseDownEvent(l,"point",l.points.length-1,0)(n)}return i.setClickInstanceInfo({paneId:t,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},n),!1}).registerEvent("mouseRightClickEvent",n=>{const s=i.getProgressInstanceInfo();if(s!==null){const o=s.instance;if(o.isDrawing())return this._figureMouseRightClickEvent(o,"point",o.points.length-1,0)(n)}return!1}).registerEvent("mouseUpEvent",n=>{var s;const{instance:o}=i.getPressedInstanceInfo();return o!==null&&((s=o.onPressedMoveEnd)===null||s===void 0||s.call(o,{overlay:o,...n})),i.setPressedInstanceInfo({paneId:t,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1}),!1}).registerEvent("pressedMouseMoveEvent",n=>{var s,o;const{instance:a,figureType:l,figureIndex:c}=i.getPressedInstanceInfo();if(a!==null){if(!(a.lock||(o=(s=a.onPressedMoving)===null||s===void 0?void 0:s.call(a,{overlay:a,...n}))!==null&&o!==void 0&&o)){const h=this._coordinateToPoint(a,n);l==="point"?a.eventPressedPointMove(h,c):a.eventPressedOtherMove(h,this.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1})}_createFigureEvents(e,t,i,n){if(!e.isDrawing())return{mouseMoveEvent:this._figureMouseMoveEvent(e,t,i,n),mouseDownEvent:this._figureMouseDownEvent(e,t,i,n),mouseRightClickEvent:this._figureMouseRightClickEvent(e,t,i,n)}}_figureMouseMoveEvent(e,t,i,n){return s=>{const o=this.getWidget().getPane();return o.getChart().getChartStore().getOverlayStore().setHoverInstanceInfo({paneId:o.getId(),instance:e,figureType:t,figureIndex:i,attrsIndex:n},s),!0}}_figureMouseDownEvent(e,t,i,n){return s=>{var o;const a=this.getWidget().getPane(),l=a.getId(),c=a.getChart().getChartStore().getOverlayStore();return e.startPressedMove(this._coordinateToPoint(e,s)),(o=e.onPressedMoveStart)===null||o===void 0||o.call(e,{overlay:e,...s}),c.setPressedInstanceInfo({paneId:l,instance:e,figureType:t,figureIndex:i,attrsIndex:n}),c.setClickInstanceInfo({paneId:l,instance:e,figureType:t,figureIndex:i,attrsIndex:n},s),!0}}_figureMouseRightClickEvent(e,t,i,n){return s=>{var o,a;return((a=(o=e.onRightClick)===null||o===void 0?void 0:o.call(e,{overlay:e,...s}))===null||a===void 0||!a)&&this.getWidget().getPane().getChart().getChartStore().getOverlayStore().removeInstance(e),!0}}_coordinateToPoint(e,t){var i,n;const s={},o=this.getWidget().getPane(),a=o.getChart(),l=o.getId(),c=a.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){const h=((i=a.getPaneById(D.XAXIS))===null||i===void 0?void 0:i.getAxisComponent()).convertFromPixel(t.x),u=(n=c.dataIndexToTimestamp(h))!==null&&n!==void 0?n:void 0;s.dataIndex=h,s.timestamp=u}if(this.coordinateToPointValueFlag()){const h=o.getAxisComponent();let u=h.convertFromPixel(t.y);if(e.mode!=="normal"&&l===D.CANDLE&&s.dataIndex!==void 0){const d=c.getDataByDataIndex(s.dataIndex);if(d!==null)if(u>d.high)if(e.mode==="weak_magnet"){const g=h.convertToPixel(d.high);u<h.convertFromPixel(g-8)&&(u=d.high)}else u=d.high;else if(u<d.low)if(e.mode==="weak_magnet"){const g=h.convertToPixel(d.low);u>h.convertFromPixel(g-8)&&(u=d.low)}else u=d.low;else{const g=Math.max(d.open,d.close),p=Math.min(d.open,d.close);u=u>g?u-g<d.high-u?g:d.high:u<p?u-d.low<p-u?d.low:p:g-u<u-p?g:p}}s.value=u}return s}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(e,t,i){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(e,t,i):super.dispatchEvent(e,t,i)}checkEventOn(e){return!0}drawImp(e){var t;const i=this.getWidget(),n=i.getPane(),s=n.getId(),o=n.getChart(),a=n.getAxisComponent(),l=(t=o.getPaneById(D.XAXIS))===null||t===void 0?void 0:t.getAxisComponent(),c=i.getBounding(),h=o.getChartStore(),u=h.getCustomApi(),d=h.getTimeScaleStore(),g=d.getDateTimeFormat(),p=d.getBarSpace(),m=h.getPrecision(),v=h.getStyles().overlay,_=h.getOverlayStore(),x=_.getHoverInstanceInfo(),f=_.getClickInstanceInfo();this.getCompleteOverlays(_,s).forEach(S=>{this._drawOverlay(e,S,c,p,m,g,u,v,l,a,x,f,d)});const y=_.getProgressInstanceInfo();if(y!==null){const S=this.getProgressOverlay(y,s);S!==null&&this._drawOverlay(e,S,c,p,m,g,u,v,l,a,x,f,d)}}_drawOverlay(e,t,i,n,s,o,a,l,c,h,u,d,g){const{points:p}=t,m=p.map(v=>{var _,x;let f=v.dataIndex;v.timestamp!==void 0&&(f=g.timestampToDataIndex(v.timestamp));const y={x:0,y:0};return f!==void 0&&(y.x=(_=c==null?void 0:c.convertToPixel(f))!==null&&_!==void 0?_:0),v.value!==void 0&&(y.y=(x=h==null?void 0:h.convertToPixel(v.value))!==null&&x!==void 0?x:0),y});if(m.length>0){const v=new Array().concat(this.getFigures(t,m,i,n,s,o,l,c,h));this.drawFigures(e,t,v,l)}this.drawDefaultFigures(e,t,m,i,s,o,a,l,c,h,u,d)}drawFigures(e,t,i,n){i.forEach((s,o)=>{const{type:a,styles:l,attrs:c,ignoreEvent:h}=s;[].concat(c).forEach((u,d)=>{var g,p;const m=h!=null&&h?void 0:this._createFigureEvents(t,"other",o,d),v={...n[a],...(g=t.styles)===null||g===void 0?void 0:g[a],...l};(p=this.createFigure(a,u,v,m))===null||p===void 0||p.draw(e)})})}getCompleteOverlays(e,t){return e.getInstances(t)}getProgressOverlay(e,t){return e.paneId===t?e.instance:null}getFigures(e,t,i,n,s,o,a,l,c){var h,u;return(u=(h=e.createPointFigures)===null||h===void 0?void 0:h.call(e,{overlay:e,coordinates:t,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:a,xAxis:l,yAxis:c}))!==null&&u!==void 0?u:[]}drawDefaultFigures(e,t,i,n,s,o,a,l,c,h,u,d){var g,p;if(t.needDefaultPointFigure&&(((g=u.instance)===null||g===void 0?void 0:g.id)===t.id&&u.figureType!=="none"||((p=d.instance)===null||p===void 0?void 0:p.id)===t.id&&d.figureType!=="none")){const m=t.styles,v={...l.point,...m==null?void 0:m.point};i.forEach(({x:_,y:x},f)=>{var y,S,b;let C=v.radius,w=v.color,T=v.borderColor,I=v.borderSize;((y=u.instance)===null||y===void 0?void 0:y.id)===t.id&&u.figureType==="point"&&u.figureIndex===f&&(C=v.activeRadius,w=v.activeColor,T=v.activeBorderColor,I=v.activeBorderSize),(S=this.createFigure("circle",{x:_,y:x,r:C+I},{color:T},this._createFigureEvents(t,"point",f,0)))===null||S===void 0||S.draw(e),(b=this.createFigure("circle",{x:_,y:x,r:C},{color:w}))===null||b===void 0||b.draw(e)})}}}class kt extends Ue{constructor(e,t){super(e,t),this._gridView=new yi(this),this._indicatorView=new Si(this),this._crosshairLineView=new Ci(this),this._tooltipView=this.createTooltipView(),this._overlayView=new Pt(this),this.addChild(this._overlayView),this.getContainer().style.cursor="crosshair"}getName(){return G}updateMain(e){this.updateMainContent(e),this._indicatorView.draw(e),this._gridView.draw(e)}createTooltipView(){return new Mt(this)}updateMainContent(e){}updateOverlay(e){this._overlayView.draw(e),this._crosshairLineView.draw(e),this._tooltipView.draw(e)}}class bi extends Je{drawImp(e){var t,i;const n=this.getWidget(),s=n.getPane(),o=s.getChart(),a=s.getChart().getChartStore(),l=n.getBounding(),c=s.getAxisComponent(),h=a.getTimeScaleStore().getBarSpace(),u=o.getStyles().candle.area,d=[],g=[];let p=Number.MAX_SAFE_INTEGER;this.eachChildren((v,_,x)=>{const{data:f,x:y}=v,{halfGapBar:S}=_,b=f[u.value];if(ke(b)){const C=c.convertToPixel(b);if(x===0){const w=y-S;g.push({x:w,y:l.height}),g.push({x:w,y:C}),d.push({x:w,y:C})}d.push({x:y,y:C}),g.push({x:y,y:C}),p=Math.min(p,C)}});const m=g.length;if(m>0){const v=g[m-1],_=v.x+h.halfGapBar;d.push({x:_,y:v.y}),g.push({x:_,y:v.y}),g.push({x:_,y:l.height})}if(d.length>0&&((t=this.createFigure("line",{coordinates:d},{color:u.lineColor,size:u.lineSize}))===null||t===void 0||t.draw(e)),g.length>0){const v=u.backgroundColor;let _;if(se(v)){const x=e.createLinearGradient(0,l.height,0,p);try{v.forEach(({offset:f,color:y})=>{x.addColorStop(f,y)})}catch{}_=x}else _=v;(i=this.createFigure("polygon",{coordinates:g},{color:_}))===null||i===void 0||i.draw(e)}}}class wi extends Je{drawImp(e){const t=this.getWidget().getPane(),i=t.getChart().getChartStore(),n=i.getStyles().candle.priceMark,s=n.high,o=n.low;if(n.show&&(s.show||o.show)){const a=i.getPrecision(),l=t.getAxisComponent();let c=Number.MIN_SAFE_INTEGER,h=0,u=Number.MAX_SAFE_INTEGER,d=0;this.eachChildren((m,v,_)=>{const{data:x,x:f}=m;c<x.high&&(c=x.high,h=f),u>x.low&&(u=x.low,d=f)});const g=l.convertToPixel(c),p=l.convertToPixel(u);s.show&&c!==Number.MIN_SAFE_INTEGER&&this._drawMark(e,B(c,a.price),{x:h,y:g},g<p?[-2,-5]:[2,5],s),o.show&&u!==Number.MAX_SAFE_INTEGER&&this._drawMark(e,B(u,a.price),{x:d,y:p},g<p?[2,5]:[-2,-5],o)}}_drawMark(e,t,i,n,s){var o,a,l;const c=i.x,h=i.y+n[0];let u,d,g;(o=this.createFigure("line",{coordinates:[{x:c-2,y:h+n[0]},{x:c,y:h},{x:c+2,y:h+n[0]}]},{color:s.color}))===null||o===void 0||o.draw(e);const{width:p}=this.getWidget().getBounding();c>p/2?(u=c-5,d=u-s.textOffset,g="right"):(u=c+5,g="left",d=u+s.textOffset);const m=h+n[1];(a=this.createFigure("line",{coordinates:[{x:c,y:h},{x:c,y:m},{x:u,y:m}]},{color:s.color}))===null||a===void 0||a.draw(e),(l=this.createFigure("text",{x:d,y:m,text:t,align:g,baseline:"middle"},{color:s.color,size:s.textSize,family:s.textFamily,weight:s.textWeight}))===null||l===void 0||l.draw(e)}}class Ei extends te{drawImp(e){var t;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getChart().getChartStore(),a=o.getStyles().candle.priceMark,l=a.last,c=l.line;if(a.show&&l.show&&c.show){const h=n.getAxisComponent(),u=o.getDataList(),d=u[u.length-1];if(d!=null){const{close:g,open:p}=d,m=h.convertToNicePixel(g);let v;v=g>p?l.upColor:g<p?l.downColor:l.noChangeColor,(t=this.createFigure("line",{coordinates:[{x:0,y:m},{x:s.width,y:m}]},{style:c.style,color:v,size:c.size,dashedValue:c.dashedValue}))===null||t===void 0||t.draw(e)}}}}const Ve={"zh-CN":{time:"",open:"",high:"",low:"",close:"",volume:""},"en-US":{time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: "}};function ge(r,e){var t,i;return(i=(t=Ve[e])===null||t===void 0?void 0:t[r])!==null&&i!==void 0?i:r}class Ii extends Mt{drawImp(e){var t;const i=this.getWidget(),n=i.getPane(),s=n.getChart().getChartStore(),o=s.getCrosshairStore().get();if(o.kLineData!==void 0){const a=i.getBounding(),l=(t=n.getYAxisWidget())===null||t===void 0?void 0:t.getBounding(),c=s.getDataList(),h=s.getPrecision(),u=s.getLocale(),d=s.getCustomApi(),g=s.getIndicatorStore().getInstances(n.getId()),p=s.getTimeScaleStore().getDateTimeFormat(),m=s.getStyles(),v=m.candle,_=m.indicator;if(v.tooltip.showType==="rect"&&_.tooltip.showType==="rect"){const x=this.isDrawTooltip(o,v.tooltip),f=this.isDrawTooltip(o,_.tooltip);this._drawRectTooltip(e,c,g,a,l,o,h,p,u,d,x,f,m,0)}else if(v.tooltip.showType==="standard"&&_.tooltip.showType==="standard"){const x=this._drawCandleStandardTooltip(e,a,o,h,p,u,d,v);this.drawIndicatorTooltip(e,c,o,g,d,a,_,x)}else if(v.tooltip.showType==="rect"&&_.tooltip.showType==="standard"){const x=this.drawIndicatorTooltip(e,c,o,g,d,a,_,0),f=this.isDrawTooltip(o,v.tooltip);this._drawRectTooltip(e,c,g,a,l,o,h,p,u,d,f,!1,m,x)}else{const x=this._drawCandleStandardTooltip(e,a,o,h,p,u,d,v),f=this.isDrawTooltip(o,_.tooltip);this._drawRectTooltip(e,c,g,a,l,o,h,p,u,d,!1,f,m,x)}}}_drawCandleStandardTooltip(e,t,i,n,s,o,a,l){const c=l.tooltip,h=c.text;let u=0;if(this.isDrawTooltip(i,c)){const d=this._getCandleTooltipData(i.kLineData,n,s,o,a,l);d.length>0&&(u+=h.marginTop+h.size+h.marginBottom,u+=this.drawStandardTooltip(e,t,d,0,h.marginTop,h))}return u}_drawRectTooltip(e,t,i,n,s,o,a,l,c,h,u,d,g,p){var m,v;const _=g.candle,x=g.indicator,f=_.tooltip,y=x.tooltip;if(u||d){const S=this._getCandleTooltipData(o.kLineData,a,l,c,h,_),{marginLeft:b,marginRight:C,marginTop:w,marginBottom:T,size:I,weight:k,family:O}=f.text,{paddingLeft:Y,paddingRight:R,paddingTop:P,paddingBottom:j,offsetLeft:E,offsetRight:z,offsetTop:J,borderSize:N,borderRadius:ie,borderColor:oe,color:le}=f.rect;let W=0,H=0,ce=0;u&&(e.font=re(I,k,O),S.forEach(xe=>{const X=xe.title,ve=xe.value,fe=`${X.text}${ve.text}`,q=e.measureText(fe).width+b+C;W=Math.max(W,q)}),ce+=(T+w+I)*S.length);const{marginLeft:Ot,marginRight:zt,marginTop:Wt,marginBottom:Yt,size:De,weight:et,family:tt}=y.text,Ht=[];if(d&&(e.font=re(De,et,tt),i.forEach(xe=>{var X;const ve=(X=this.getIndicatorTooltipData(t,o,xe,h,x).values)!==null&&X!==void 0?X:[];Ht.push(ve),ve.forEach(fe=>{const q=fe.title,ye=fe.value,me=`${q.text}${ye.text}`,he=e.measureText(me).width+Ot+zt;W=Math.max(W,he),ce+=Wt+Yt+De})})),H+=W,H!==0&&ce!==0){H+=2*N+Y+R,ce+=2*N+P+j;const xe=n.width/2;let X;((m=o.realX)!==null&&m!==void 0?m:0)<xe?(X=n.width-z-H,g.yAxis.inside&&g.yAxis.position==="right"&&(X-=s.width)):(X=E,g.yAxis.inside&&g.yAxis.position==="left"&&(X+=s.width));const ve=p+J;(v=this.createFigure("rect",{x:X,y:ve,width:H,height:ce},{style:"stroke_fill",color:le,borderColor:oe,borderSize:N,borderRadius:ie}))===null||v===void 0||v.draw(e);const fe=X+N+Y+b;let q=ve+N+P;if(u&&S.forEach(ye=>{var me,he;q+=w;const Se=ye.title;(me=this.createFigure("text",{x:fe,y:q,text:Se.text},{color:Se.color,size:I,family:O,weight:k}))===null||me===void 0||me.draw(e);const Ce=ye.value;(he=this.createFigure("text",{x:X+H-N-C-R,y:q,text:Ce.text,align:"right"},{color:Ce.color,size:I,family:O,weight:k}))===null||he===void 0||he.draw(e),q+=I+T}),d){const ye=X+N+Y+Ot;Ht.forEach(me=>{me.forEach(he=>{var Se,Ce;q+=Wt;const Xt=he.title,$t=he.value;(Se=this.createFigure("text",{x:ye,y:q,text:Xt.text},{color:Xt.color,size:De,family:tt,weight:et}))===null||Se===void 0||Se.draw(e),(Ce=this.createFigure("text",{x:X+H-N-zt-R,y:q,text:$t.text,align:"right"},{color:$t.color,size:De,family:tt,weight:et}))===null||Ce===void 0||Ce.draw(e),q+=De+Yt})})}}}}_getCandleTooltipData(e,t,i,n,s,o){var a,l,c;const h=o.tooltip,u=h.text.color;let d=[];if(Pe(h.custom))((l=(a=h.custom)===null||a===void 0?void 0:a.call(h,e,o))!==null&&l!==void 0?l:[]).forEach(({title:g,value:p})=>{let m={text:"",color:""};K(g)?m=g:(m.text=g,m.color=u),m.text=ge(m.text,n);let v={text:"",color:""};K(p)?v=p:(v.text=p,v.color=u),d.push({title:m,value:v})});else{const{price:g,volume:p}=t;d=[{title:{text:ge("time",n),color:u},value:{text:s.formatDate(i,e.timestamp,"YYYY-MM-DD HH:mm",0),color:u}},{title:{text:ge("open",n),color:u},value:{text:B(e.open,g),color:u}},{title:{text:ge("high",n),color:u},value:{text:B(e.high,g),color:u}},{title:{text:ge("low",n),color:u},value:{text:B(e.low,g),color:u}},{title:{text:ge("close",n),color:u},value:{text:B(e.close,g),color:u}},{title:{text:ge("volume",n),color:u},value:{text:s.formatBigNumber(B((c=e.volume)!==null&&c!==void 0?c:h.defaultValue,p)),color:u}}]}return d}}class Ti extends kt{constructor(){super(...arguments),this._candleBarView=new Dt(this),this._candleAreaView=new bi(this),this._candleHighLowPriceView=new wi(this),this._candleLastPriceLineView=new Ei(this)}updateMainContent(e){this.getPane().getChart().getStyles().candle.type!=="area"?(this._candleBarView.draw(e),this._candleHighLowPriceView.draw(e),this._candleLastPriceLineView.draw(e)):this._candleAreaView.draw(e)}createTooltipView(){return new Ii(this)}}class At extends te{drawImp(e){var t;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getAxisComponent(),a=this.getAxisStyles(n.getChart().getStyles());if(a.show){a.axisLine.show&&((t=this.createFigure("line",this.createAxisLine(s,a),a.axisLine))===null||t===void 0||t.draw(e));const l=o.getTicks();a.tickLine.show&&this.createTickLines(l,s,a).forEach(c=>{var h;(h=this.createFigure("line",c,a.tickLine))===null||h===void 0||h.draw(e)}),a.tickText.show&&this.createTickTexts(l,s,a).forEach(c=>{var h;(h=this.createFigure("text",c,a.tickText))===null||h===void 0||h.draw(e)})}}}class Di extends At{getAxisStyles(e){return e.yAxis}createAxisLine(e,t){const i=this.getWidget().getPane().getAxisComponent(),n=t.axisLine.size;let s;return s=i.isFromZero()?n/2:e.width-n,{coordinates:[{x:s,y:0},{x:s,y:e.height}]}}createTickLines(e,t,i){const n=this.getWidget().getPane().getAxisComponent(),s=i.axisLine,o=i.tickLine;let a=0,l=0;return n.isFromZero()?(a=0,s.show&&(a+=s.size),l=a+o.length):(a=t.width,s.show&&(a-=s.size),l=a-o.length),e.map(c=>({coordinates:[{x:a,y:c.coord},{x:l,y:c.coord}]}))}createTickTexts(e,t,i){const n=this.getWidget().getPane().getAxisComponent(),s=i.axisLine,o=i.tickLine,a=i.tickText;let l=0;n.isFromZero()?(l=a.marginStart,s.show&&(l+=s.size),o.show&&(l+=o.length)):(l=t.width-a.marginEnd,s.show&&(l-=s.size),o.show&&(l-=o.length));const c=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return e.map(h=>({x:l,y:h.coord,text:h.text,align:c,baseline:"middle"}))}}class Mi extends te{drawImp(e){var t;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getChart().getChartStore(),a=o.getStyles().candle.priceMark,l=a.last,c=l.text;if(a.show&&l.show&&c.show){const h=o.getPrecision(),u=n.getAxisComponent(),d=o.getDataList(),g=o.getVisibleDataList(),p=d[d.length-1];if(p!==void 0){const{close:m,open:v}=p,_=u.convertToNicePixel(m);let x,f,y,S;if(x=m>v?l.upColor:m<v?l.downColor:l.noChangeColor,u.getType()==="percentage"){const b=g[0].data.close;f=`${((m-b)/b*100).toFixed(2)}%`}else f=B(m,h.price);u.isFromZero()?(y=0,S="left"):(y=s.width,S="right"),(t=this.createFigure("rectText",{x:y,y:_,text:f,align:S,baseline:"middle"},{...c,backgroundColor:x}))===null||t===void 0||t.draw(e)}}}}class Pi extends te{drawImp(e){const t=this.getWidget(),i=t.getPane(),n=t.getBounding(),s=i.getChart().getChartStore(),o=s.getCustomApi(),a=s.getStyles().indicator,l=a.lastValueMark,c=l.text;if(l.show){const h=i.getAxisComponent(),u=s.getDataList(),d=u.length-1;s.getIndicatorStore().getInstances(i.getId()).forEach(g=>{const p=g.result[d];if(p!==void 0){const m=g.precision;$e(u,g,d,a,(v,_)=>{var x;const f=p[v.key];if(L(f)){const y=h.convertToNicePixel(f);let S,b,C=B(f,m);g.shouldFormatBigNumber&&(C=o.formatBigNumber(C)),h.isFromZero()?(S=0,b="left"):(S=n.width,b="right"),(x=this.createFigure("rectText",{x:S,y,text:C,align:b,baseline:"middle"},{...c,backgroundColor:_.color}))===null||x===void 0||x.draw(e)}})}})}}}class Ft extends Pt{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(e,t,i,n,s,o,a,l,c,h,u,d){this.drawFigures(e,t,this.getDefaultFigures(t,i,n,s,o,a,c,h,d),l)}getDefaultFigures(e,t,i,n,s,o,a,l,c){var h,u;const d=[];if(e.needDefaultYAxisFigure&&e.id===((h=c.instance)===null||h===void 0?void 0:h.id)&&c.paneId===this.getWidget().getPane().getId()){let g=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,m,v;(u=l==null?void 0:l.isFromZero())!==null&&u!==void 0&&u?(m="left",v=0):(m="right",v=i.width),t.forEach((_,x)=>{const f=e.points[x];if(f.value!==void 0){g=Math.min(g,_.y),p=Math.max(p,_.y);const y=B(f.value,n.price);d.push({type:"rectText",attrs:{x:v,y:_.y,text:y,align:m,baseline:"middle"},ignoreEvent:!0})}}),t.length>1&&d.unshift({type:"rect",attrs:{x:0,y:g,width:i.width,height:p-g},ignoreEvent:!0})}return d}getFigures(e,t,i,n,s,o,a,l,c){var h,u;return(u=(h=e.createYAxisFigures)===null||h===void 0?void 0:h.call(e,{overlay:e,coordinates:t,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:a,xAxis:l,yAxis:c}))!==null&&u!==void 0?u:[]}}class Lt extends te{drawImp(e){var t;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=i.getPane().getChart().getChartStore(),a=o.getCrosshairStore().get(),l=o.getStyles().crosshair;if(a.paneId!==void 0&&a.kLineData!==void 0&&this.checkPaneId(a,n.getId())&&l.show){const c=this.getDirectionStyles(l),h=c.text;if(c.show&&h.show){const u=n.getAxisComponent(),d=this.getText(a,o,u);e.font=re(h.size,h.weight,h.family),(t=this.createFigure("rectText",this.getTextAttrs(d,e.measureText(d).width,a,s,u,h),h))===null||t===void 0||t.draw(e)}}}checkPaneId(e,t){return e.paneId===t}getDirectionStyles(e){return e.horizontal}getText(e,t,i){var n,s;const o=i,a=i.convertFromPixel(e.y);let l;if(o.getType()==="percentage"){const c=(s=(n=t.getVisibleDataList()[0])===null||n===void 0?void 0:n.data)!==null&&s!==void 0?s:{};l=`${((a-c.close)/c.close*100).toFixed(2)}%`}else{const c=t.getIndicatorStore().getInstances(e.paneId);let h=0,u=!1;o.isInCandle()?h=t.getPrecision().price:c.forEach(d=>{h=Math.max(d.precision,h),u||(u=d.shouldFormatBigNumber)}),l=B(a,h),u&&(l=t.getCustomApi().formatBigNumber(l))}return l}getTextAttrs(e,t,i,n,s,o){let a,l;return s.isFromZero()?(a=0,l="left"):(a=n.width,l="right"),{x:a,y:i.y,text:e,align:l,baseline:"middle"}}}class ki extends Ue{constructor(e,t){super(e,t),this._yAxisView=new Di(this),this._candleLastPriceLabelView=new Mi(this),this._indicatorLastValueView=new Pi(this),this._overlayYAxisView=new Ft(this),this._crosshairHorizontalLabelView=new Lt(this),this.getContainer().style.cursor="ns-resize",this.addChild(this._overlayYAxisView)}getName(){return ee}updateMain(e){this._yAxisView.draw(e),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(e),this._indicatorLastValueView.draw(e)}updateOverlay(e){this._overlayYAxisView.draw(e),this._crosshairHorizontalLabelView.draw(e)}}class Bt{constructor(e){this._extremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._prevExtremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=e}getParent(){return this._parent}buildTicks(e){return this._autoCalcTickFlag&&(this._extremum=this.calcExtremum()),!(this._prevExtremum.min===this._extremum.min&&this._prevExtremum.max===this._extremum.max&&!e)&&(this._prevExtremum=this._extremum,this._ticks=this.optimalTicks(this._calcTicks()),!0)}getTicks(){return this._ticks}setExtremum(e){this._autoCalcTickFlag=!1,this._extremum=e}getExtremum(){return this._extremum}setAutoCalcTickFlag(e){this._autoCalcTickFlag=e}getAutoCalcTickFlag(){return this._autoCalcTickFlag}_calcTicks(){const{realMin:e,realMax:t,realRange:i}=this._extremum,n=[];if(i>=0){const[s,o]=this._calcTickInterval(i),a=rt(Math.ceil(e/s)*s,o),l=rt(Math.floor(t/s)*s,o);let c=0,h=a;if(s!==0)for(;h<=l;){const u=h.toFixed(o);n[c]={text:u,coord:0,value:u},++c,h+=s}}return n}_calcTickInterval(e){const t=function(i){const n=Math.floor(be(i)),s=de(n),o=i/s;let a=0;return a=o<1.5?1:o<2.5?2:o<3.5?3:o<4.5?4:o<5.5?5:o<6.5?6:8,i=a*s,n>=-20?+i.toFixed(n<0?-n:0):i}(e/8);return[t,function(i){const n=i.toString(),s=n.indexOf("e");if(s>0){const o=+n.slice(s+1);return o<0?-o:0}{const o=n.indexOf(".");return o<0?0:n.length-1-o}}(t)]}}class Ai extends Bt{calcExtremum(){var e,t,i,n,s;const o=this.getParent(),a=o.getChart(),l=a.getChartStore();let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const u=[];let d=!1,g=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,m=Number.MAX_SAFE_INTEGER;l.getIndicatorStore().getInstances(o.getId()).forEach(E=>{var z,J,N;d||(d=(z=E.shouldOhlc)!==null&&z!==void 0&&z),m=Math.min(m,E.precision),E.minValue!==null&&(g=Math.min(g,E.minValue)),E.maxValue!==null&&(p=Math.max(p,E.maxValue)),u.push({figures:(J=E.figures)!==null&&J!==void 0?J:[],result:(N=E.result)!==null&&N!==void 0?N:[]})});let v=4;const _=this.isInCandle();if(_){const{price:E}=l.getPrecision();v=m!==Number.MAX_SAFE_INTEGER?Math.min(m,E):E}else m!==Number.MAX_SAFE_INTEGER&&(v=m);const x=l.getVisibleDataList(),f=a.getStyles().candle,y=f.type==="area",S=f.area.value,b=_&&!y||!_&&d;x.forEach(({dataIndex:E,data:z})=>{b&&(c=Math.min(c,z.low),h=Math.max(h,z.high)),_&&y&&(c=Math.min(c,z[S]),h=Math.max(h,z[S])),u.forEach(({figures:J,result:N})=>{var ie;const oe=(ie=N[E])!==null&&ie!==void 0?ie:{};J.forEach(le=>{const W=oe[le.key];L(W)&&(c=Math.min(c,W),h=Math.max(h,W))})})}),c!==Number.MAX_SAFE_INTEGER&&h!==Number.MIN_SAFE_INTEGER?(c=Math.min(g,c),h=Math.max(p,h)):(c=0,h=10);const C=this.getType();let w;switch(C){case"percentage":{const E=(e=x[0])===null||e===void 0?void 0:e.data;(E==null?void 0:E.close)!==void 0&&(c=(c-E.close)/E.close*100,h=(h-E.close)/E.close*100),w=Math.pow(10,-2);break}case"log":c=be(c),h=be(h),w=.05*de(-v);break;default:w=de(-v)}if(c===h||Math.abs(c-h)<w){const E=g===c,z=p===h;c=E?c:z?c-8*w:c-4*w,h=z?h:E?h+8*w:h+4*w}const T=(i=(t=this.getParent().getYAxisWidget())===null||t===void 0?void 0:t.getBounding().height)!==null&&i!==void 0?i:0,{gap:I}=o.getOptions();let k=(n=I==null?void 0:I.top)!==null&&n!==void 0?n:.2;k>=1&&(k/=T);let O=(s=I==null?void 0:I.bottom)!==null&&s!==void 0?s:.1;O>=1&&(O/=T);let Y,R,P,j=Math.abs(h-c);return c-=j*O,h+=j*k,j=Math.abs(h-c),C==="log"?(Y=de(c),R=de(h),P=Math.abs(R-Y)):(Y=c,R=h,P=j),{min:c,max:h,range:j,realMin:Y,realMax:R,realRange:P}}_innerConvertToPixel(e){var t,i;const n=(i=(t=this.getParent().getYAxisWidget())===null||t===void 0?void 0:t.getBounding().height)!==null&&i!==void 0?i:0,{min:s,range:o}=this.getExtremum(),a=(e-s)/o;return this.isReverse()?Math.round(a*n):Math.round((1-a)*n)}isInCandle(){return this.getParent().getName()==="candle"}getType(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:"normal"}getPosition(){return this.getParent().getChart().getStyles().yAxis.position}isReverse(){return!!this.isInCandle()&&this.getParent().getChart().getStyles().yAxis.reverse}isFromZero(){const e=this.getParent().getChart().getStyles().yAxis,t=e.inside;return e.position==="left"&&t||e.position==="right"&&!t}optimalTicks(e){var t,i;const n=this.getParent(),s=(i=(t=n.getYAxisWidget())===null||t===void 0?void 0:t.getBounding().height)!==null&&i!==void 0?i:0,o=n.getChart().getChartStore(),a=o.getCustomApi(),l=[],c=this.getType(),h=o.getIndicatorStore().getInstances(n.getId());let u=0,d=!1;this.isInCandle()?u=o.getPrecision().price:h.forEach(m=>{u=Math.max(u,m.precision),d||(d=m.shouldFormatBigNumber)});const g=o.getStyles().xAxis.tickText.size;let p;return e.forEach(({value:m})=>{let v,_=this._innerConvertToPixel(+m);switch(c){case"percentage":v=`${B(m,2)}%`;break;case"log":_=this._innerConvertToPixel(be(+m)),v=B(m,u);break;default:v=B(m,u),d&&(v=a.formatBigNumber(m))}_>g&&_<s-g&&(p!==void 0&&Math.abs(p-_)>2*g||p===void 0)&&(l.push({text:v,coord:_,value:m}),p=_)}),l}getAutoSize(){const e=this.getParent(),t=e.getChart(),i=t.getStyles(),n=i.yAxis,s=n.size;if(s!=="auto")return s;const o=t.getChartStore(),a=o.getCustomApi();let l=0;if(n.show&&(n.axisLine.show&&(l+=n.axisLine.size),n.tickLine.show&&(l+=n.tickLine.length),n.tickText.show)){let u=0;this.getTicks().forEach(d=>{u=Math.max(u,Ye(d.text,n.tickText.size,n.tickText.weight,n.tickText.family))}),l+=n.tickText.marginStart+n.tickText.marginEnd+u}const c=i.crosshair;let h=0;if(c.show&&c.horizontal.show&&c.horizontal.text.show){const u=o.getIndicatorStore().getInstances(e.getId());let d=0,g=!1;u.forEach(v=>{d=Math.max(v.precision,d),g||(g=v.shouldFormatBigNumber)});let p=2;if(this.getType()!=="percentage")if(this.isInCandle()){const{price:v}=o.getPrecision(),_=i.indicator.lastValueMark;p=_.show&&_.text.show?Math.max(d,v):v}else p=d;let m=B(this.getExtremum().max,p);g&&(m=a.formatBigNumber(m)),h+=c.horizontal.text.paddingLeft+c.horizontal.text.paddingRight+2*c.horizontal.text.borderSize+Ye(m,c.horizontal.text.size,c.horizontal.text.weight,c.horizontal.text.family)}return Math.max(l,h)}convertFromPixel(e){var t,i,n;const s=(i=(t=this.getParent().getYAxisWidget())===null||t===void 0?void 0:t.getBounding().height)!==null&&i!==void 0?i:0,{min:o,range:a}=this.getExtremum(),l=(this.isReverse()?e/s:1-e/s)*a+o;switch(this.getType()){case"percentage":{const c=(n=this.getParent().getChart().getChartStore().getVisibleDataList()[0])===null||n===void 0?void 0:n.data;return(c==null?void 0:c.close)!==void 0?c.close*l/100+c.close:0}case"log":return de(l);default:return l}}convertToRealValue(e){let t=e;return this.getType()==="log"&&(t=de(e)),t}convertToPixel(e){var t;let i=e;switch(this.getType()){case"percentage":{const n=(t=this.getParent().getChart().getChartStore().getVisibleDataList()[0])===null||t===void 0?void 0:t.data;(n==null?void 0:n.close)!==void 0&&(i=(e-n.close)/n.close*100);break}case"log":i=be(e);break;default:i=e}return this._innerConvertToPixel(i)}convertToNicePixel(e){var t,i;const n=(i=(t=this.getParent().getYAxisWidget())===null||t===void 0?void 0:t.getBounding().height)!==null&&i!==void 0?i:0,s=this.convertToPixel(e);return Math.round(Math.max(.05*n,Math.min(s,.98*n)))}}class Rt extends pt{getName(){return"indicator"}createAxisComponent(){return new Ai(this)}createMainWidget(e){return new kt(e,this)}createSeparatorWidget(e){return new hi(e,this)}creatYAxisWidget(e){return new ki(e,this)}}class Fi extends Rt{getName(){return"candle"}createMainWidget(e){return new Ti(e,this)}createSeparatorWidget(e){return null}}class Li extends At{getAxisStyles(e){return e.xAxis}createAxisLine(e,t){const i=t.axisLine.size/2;return{coordinates:[{x:0,y:i},{x:e.width,y:i}]}}createTickLines(e,t,i){const n=i.tickLine,s=i.axisLine.size;return e.map(o=>({coordinates:[{x:o.coord,y:0},{x:o.coord,y:s+n.length}]}))}createTickTexts(e,t,i){const n=i.tickText,s=i.axisLine.size,o=i.tickLine.length;return e.map(a=>({x:a.coord,y:s+o+n.marginStart,text:a.text,align:"center",baseline:"top"}))}}class Bi extends Ft{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(e){return e.getInstances()}getProgressOverlay(e){return e.instance}getDefaultFigures(e,t,i,n,s,o,a,l,c){var h;const u=[];if(e.needDefaultXAxisFigure&&e.id===((h=c.instance)===null||h===void 0?void 0:h.id)){let d=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;t.forEach((p,m)=>{d=Math.min(d,p.x),g=Math.max(g,p.x);const v=e.points[m];if(v.timestamp!==void 0){const _=o.formatDate(s,v.timestamp,"YYYY-MM-DD HH:mm",1);u.push({type:"rectText",attrs:{x:p.x,y:0,text:_,align:"center"},ignoreEvent:!0})}}),t.length>1&&u.unshift({type:"rect",attrs:{x:d,y:0,width:g-d,height:i.height},ignoreEvent:!0})}return u}getFigures(e,t,i,n,s,o,a,l,c){var h,u;return(u=(h=e.createXAxisFigures)===null||h===void 0?void 0:h.call(e,{overlay:e,coordinates:t,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:a,xAxis:l,yAxis:c}))!==null&&u!==void 0?u:[]}}class Ri extends Lt{checkPaneId(e){return e.dataIndex===e.realDataIndex}getDirectionStyles(e){return e.vertical}getText(e,t,i){var n;const s=(n=e.kLineData)===null||n===void 0?void 0:n.timestamp;return t.getCustomApi().formatDate(t.getTimeScaleStore().getDateTimeFormat(),s,"YYYY-MM-DD HH:mm",1)}getTextAttrs(e,t,i,n,s,o){const a=i.realX;let l;return l=a-t/2-o.paddingLeft<0?o.paddingLeft+t/2:a+t/2+o.paddingRight>n.width?n.width-o.paddingRight-t/2:a,{x:l,y:0,text:e,align:"center",baseline:"top"}}}class Ni extends Ue{constructor(e,t){super(e,t),this._xAxisView=new Li(this),this._overlayXAxisView=new Bi(this),this._crosshairVerticalLabelView=new Ri(this),this.getContainer().style.cursor="ew-resize",this.addChild(this._overlayXAxisView)}getName(){return Q}updateMain(e){this._xAxisView.draw(e)}updateOverlay(e){this._overlayXAxisView.draw(e),this._crosshairVerticalLabelView.draw(e)}}class Vi extends Bt{calcExtremum(){const e=this.getParent().getChart().getChartStore(),{from:t,to:i}=e.getTimeScaleStore().getVisibleRange(),n=i-1,s=i-t;return{min:t,max:n,range:s,realMin:t,realMax:n,realRange:s}}optimalTicks(e){var t,i;const n=this.getParent().getChart(),s=n.getChartStore(),o=s.getCustomApi().formatDate,a=[],l=e.length,c=s.getDataList();if(l>0){const h=s.getTimeScaleStore().getDateTimeFormat(),u=n.getStyles().xAxis.tickText,d=Ye("00-00 00:00",u.size,u.weight,u.family),g=parseInt(e[0].value,10),p=this.convertToPixel(g);let m=1;if(l>1){const v=parseInt(e[1].value,10),_=this.convertToPixel(v),x=Math.abs(_-p);x<d&&(m=Math.ceil(d/x))}for(let v=0;v<l;v+=m){const _=parseInt(e[v].value,10),x=c[_].timestamp;let f=o(h,x,"HH:mm",2);if(v!==0){const S=c[parseInt(e[v-m].value,10)].timestamp;f=(t=this._optimalTickLabel(o,h,x,S))!==null&&t!==void 0?t:f}const y=this.convertToPixel(_);a.push({text:f,coord:y,value:x})}if(a.length===1)a[0].text=o(h,a[0].value,"YYYY-MM-DD HH:mm",2);else{const v=a[0].value,_=a[1].value;if(a[2]!==void 0){const x=a[2].text;/^[0-9]{2}-[0-9]{2}$/.test(x)?a[0].text=o(h,v,"MM-DD",2):/^[0-9]{4}-[0-9]{2}$/.test(x)?a[0].text=o(h,v,"YYYY-MM",2):/^[0-9]{4}$/.test(x)&&(a[0].text=o(h,v,"YYYY",2))}else a[0].text=(i=this._optimalTickLabel(o,h,v,_))!==null&&i!==void 0?i:a[0].text}}return a}_optimalTickLabel(e,t,i,n){const s=e(t,i,"YYYY",2),o=e(t,i,"YYYY-MM",2),a=e(t,i,"MM-DD",2);return s!==e(t,n,"YYYY",2)?s:o!==e(t,n,"YYYY-MM",2)?o:a!==e(t,n,"MM-DD",2)?a:null}getAutoSize(){const e=this.getParent().getChart().getStyles(),t=e.xAxis,i=t.size;if(i!=="auto")return i;const n=e.crosshair;let s=0;t.show&&(t.axisLine.show&&(s+=t.axisLine.size),t.tickLine.show&&(s+=t.tickLine.length),t.tickText.show&&(s+=t.tickText.marginStart+t.tickText.marginEnd+t.tickText.size));let o=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(o+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+2*n.vertical.text.borderSize+n.vertical.text.size),Math.max(s,o)}convertFromPixel(e){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(e)}convertToPixel(e){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(e)}}class Oi extends pt{getName(){return"xAxis"}createAxisComponent(){return new Vi(this)}createMainWidget(e){return new Ni(e,this)}}function Nt(){var r;return typeof window<"u"&&((r=window.navigator.userAgent.toLowerCase().indexOf("firefox"))!==null&&r!==void 0?r:-1)>-1}function Qe(){return typeof window<"u"&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class zi{constructor(e,t,i){this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!Qe(),this._onFirefoxOutsideMouseUp=n=>{this._mouseUpHandler(n)},this._onMobileSafariDoubleClick=n=>{if(this._firesTouchEvents(n)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(n),this._tapCoordinate);s<30&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(n),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(n),this._clickCoordinate);s<5&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(n),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}},this._target=e,this._handler=t,this._options=i,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){var t,i,n;(t=this._unsubscribeMousemove)===null||t===void 0||t.call(this),(i=this._unsubscribeMouseWheel)===null||i===void 0||i.call(this),(n=this._unsubscribeContextMenu)===null||n===void 0||n.call(this);const s=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",s)},this._target.addEventListener("mousemove",s);const o=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",o)},this._target.addEventListener("wheel",o,{passive:!1});const a=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",a)},this._target.addEventListener("contextmenu",a,{passive:!1}),this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(this._handler.mouseWheelHortEvent===void 0||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(this._handler.mouseWheelVertEvent===void 0)return;let t=-e.deltaY/100;if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:t*=120;break;case e.DOM_DELTA_LINE:t*=32}if(t!==0){const i=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),i)}}}_contextMenuHandler(e){this._preventDefault(e)}_touchMoveHandler(e){const t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const i=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),{xOffset:n,yOffset:s,manhattanDistance:o}=i;if(this._touchMoveExceededManhattanDistance||!(o<5)){if(!this._touchMoveExceededManhattanDistance){const a=.5*n,l=s>=a&&!this._options.treatVertDragAsPageScroll(),c=a>s&&!this._options.treatHorzDragAsPageScroll();l||c||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(e){if(e.button!==0)return;const t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),{manhattanDistance:i}=t;i>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(e,t){const i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return{xOffset:i,yOffset:n,manhattanDistance:i+n}}_touchEndHandler(e){let t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const i=this._makeCompatEvent(e,t);if(this._processEvent(i,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:n}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);n<30&&!this._cancelTap&&this._processEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(i,this._handler.tapEvent),this._handler.tapEvent!==void 0&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}_mouseUpHandler(e){if(e.button!==0)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Nt()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);i<5&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(this._activeTouchId!==null)return;const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);const i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const n=this._touchMoveHandler.bind(this),s=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",n),i.removeEventListener("touchend",s)},i.addEventListener("touchmove",n,{passive:!1}),i.addEventListener("touchend",s,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),240)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(t))}_mouseDownHandler(e){if(e.button===2)return this._preventDefault(e),void this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);if(e.button!==0)return;const t=this._target.ownerDocument.documentElement;Nt()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const i=this._mouseMoveWithDownHandler.bind(this),n=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",i),t.removeEventListener("mouseup",n)},t.addEventListener("mousemove",i),t.addEventListener("mouseup",n)}this._mousePressed=!0,this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(e)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const e=this._target.ownerDocument,t=i=>{this._handler.mouseDownOutsideEvent!=null&&(i.composed&&this._target.contains(i.composedPath()[0])||i.target!==null&&this._target.contains(i.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",t)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",t)},e.addEventListener("mousedown",t),e.addEventListener("touchstart",t,{passive:!0})}Qe()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),typeof window<"u"&&window.chrome!==void 0&&(this._target.addEventListener("mousedown",e=>{if(e.button===1)return e.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1}))}_initPinch(){this._handler.pinchStartEvent===void 0&&this._handler.pinchEvent===void 0&&this._handler.pinchEndEvent===void 0||(this._target.addEventListener("touchstart",e=>this._checkPinchState(e.touches),{passive:!0}),this._target.addEventListener("touchmove",e=>{if(e.touches.length===2&&this._startPinchMiddleCoordinate!==null&&this._handler.pinchEvent!==void 0){const t=this._getTouchDistance(e.touches[0],e.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},t),this._preventDefault(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{this._checkPinchState(e.touches)}))}_checkPinchState(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){var t;const i=(t=this._target.getBoundingClientRect())!==null&&t!==void 0?t:{left:0,top:0};this._startPinchMiddleCoordinate={x:(e[0].clientX-i.left+(e[1].clientX-i.left))/2,y:(e[0].clientY-i.top+(e[1].clientY-i.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),this._handler.pinchStartEvent!==void 0&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,this._handler.pinchEndEvent!==void 0&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(e){var t,i,n;(t=this._unsubscribeMousemove)===null||t===void 0||t.call(this),(i=this._unsubscribeMouseWheel)===null||i===void 0||i.call(this),(n=this._unsubscribeContextMenu)===null||n===void 0||n.call(this),this._firesTouchEvents(e)||this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!Qe())}_longTapHandler(e){const t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(e){var t;return((t=e.sourceCapabilities)===null||t===void 0?void 0:t.firesTouchEvents)!==void 0?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+500}_processEvent(e,t){t==null||t.call(this._handler,e)}_makeCompatEvent(e,t){var i;const n=t??e,s=(i=this._target.getBoundingClientRect())!==null&&i!==void 0?i:{left:0,top:0};return{x:n.clientX-s.left,y:n.clientY-s.top,pageX:n.pageX,pageY:n.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click",preventDefault:()=>{e.type!=="touchstart"&&this._preventDefault(e)}}}_getTouchDistance(e,t){const i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)}_preventDefault(e){e.cancelable&&e.preventDefault()}_getCoordinate(e){return{x:e.pageX,y:e.pageY}}_eventTimeStamp(e){var t;return(t=e.timeStamp)!==null&&t!==void 0?t:performance.now()}_touchWithId(e,t){for(let i=0;i<e.length;++i)if(e[i].identifier===t)return e[i];return null}}class Wi{constructor(e,t){this._flingStartTime=new Date().getTime(),this._flingScrollTimerId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=i=>{if(i.shiftKey)switch(i.code){case"Equal":this._chart.getChartStore().getTimeScaleStore().zoom(.5);break;case"Minus":this._chart.getChartStore().getTimeScaleStore().zoom(-.5);break;case"ArrowLeft":{const n=this._chart.getChartStore().getTimeScaleStore();n.startScroll(),n.scroll(-3*n.getBarSpace().bar);break}case"ArrowRight":{const n=this._chart.getChartStore().getTimeScaleStore();n.startScroll(),n.scroll(3*n.getBarSpace().bar);break}}},this._container=e,this._chart=t,this._event=new zi(e,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(e,t){const{pane:i,widget:n}=this._findWidgetByEvent(e);if((i==null?void 0:i.getId())!==D.XAXIS&&(n==null?void 0:n.getName())===G){const s=this._makeWidgetEvent(e,n),o=5*(t-this._pinchScale);return this._pinchScale=t,this._chart.getChartStore().getTimeScaleStore().zoom(o,{x:s.x,y:s.y}),!0}return!1}mouseWheelHortEvent(e,t){const i=this._chart.getChartStore().getTimeScaleStore();return i.startScroll(),i.scroll(t),!0}mouseWheelVertEvent(e,t){var i,n;const{widget:s}=this._findWidgetByEvent(e),o=(i=e.isTouch)!==null&&i!==void 0&&i,a=this._makeWidgetEvent(e,s);let l=null;const c=s==null?void 0:s.getName();if(o)if(c===G||c===Q)l={x:a.x,y:a.y};else{const h=(n=this._chart.getPaneById(D.CANDLE))===null||n===void 0?void 0:n.getBounding();l={x:h.width/2,y:h.height/2}}else c===G&&(l={x:a.x,y:a.y});return l!==null&&(this._chart.getChartStore().getTimeScaleStore().zoom(t,{x:a.x,y:a.y}),!0)}mouseDownEvent(e){var t,i;const{pane:n,widget:s}=this._findWidgetByEvent(e);if(this._mouseDownWidget=s,s!==null){const o=this._makeWidgetEvent(e,s);switch(s.getName()){case Ee:return s.dispatchEvent("mouseDownEvent",o);case G:{const a=(t=n==null?void 0:n.getAxisComponent().getExtremum())!==null&&t!==void 0?t:null;return this._prevYAxisExtremum=a===null?a:{...a},this._startScrollCoordinate={x:o.x,y:o.y},this._chart.getChartStore().getTimeScaleStore().startScroll(),s.dispatchEvent("mouseDownEvent",o)}case Q:{const a=s.dispatchEvent("mouseDownEvent",o);return a&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:o.x,y:o.y},this._xAxisStartScaleDistance=o.pageX,a}case ee:{const a=s.dispatchEvent("mouseDownEvent",o);a&&this._chart.updatePane(1);const l=(i=n==null?void 0:n.getAxisComponent().getExtremum())!==null&&i!==void 0?i:null;return this._prevYAxisExtremum=l===null?l:{...l},this._yAxisStartScaleDistance=o.pageY,a}}}return!1}mouseMoveEvent(e){var t,i,n;const{pane:s,widget:o}=this._findWidgetByEvent(e),a=this._makeWidgetEvent(e,o);if(((t=this._mouseMoveTriggerWidgetInfo.pane)===null||t===void 0?void 0:t.getId())===(s==null?void 0:s.getId())&&((i=this._mouseMoveTriggerWidgetInfo.widget)===null||i===void 0?void 0:i.getName())===(o==null?void 0:o.getName())||(o==null||o.dispatchEvent("mouseEnterEvent",a),(n=this._mouseMoveTriggerWidgetInfo.widget)===null||n===void 0||n.dispatchEvent("mouseLeaveEvent",a),this._mouseMoveTriggerWidgetInfo={pane:s,widget:o}),o!==null)switch(o.getName()){case G:return this._chart.getChartStore().getCrosshairStore().set({x:a.x,y:a.y,paneId:s==null?void 0:s.getId()}),o.dispatchEvent("mouseMoveEvent",a);case Ee:case Q:case ee:{const l=o.dispatchEvent("mouseMoveEvent",a);return this._chart.getChartStore().getCrosshairStore().set(),l}}return!1}pressedMouseMoveEvent(e){var t,i,n,s;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===Ee)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);const{pane:o,widget:a}=this._findWidgetByEvent(e);if(a!==null&&((t=this._mouseDownWidget)===null||t===void 0?void 0:t.getPane().getId())===(o==null?void 0:o.getId())&&((i=this._mouseDownWidget)===null||i===void 0?void 0:i.getName())===a.getName()){const l=this._makeWidgetEvent(e,a);switch(a.getName()){case G:{const c=a.getBounding(),h=a.dispatchEvent("pressedMouseMoveEvent",l);if(!h&&this._startScrollCoordinate!==null){const u=o==null?void 0:o.getAxisComponent();if(this._prevYAxisExtremum!==null&&!u.getAutoCalcTickFlag()){const{min:g,max:p,range:m}=this._prevYAxisExtremum;let v;v=(n=u==null?void 0:u.isReverse())!==null&&n!==void 0&&n?this._startScrollCoordinate.y-l.y:l.y-this._startScrollCoordinate.y;const _=m*(v/c.height),x=g+_,f=p+_,y=u.convertToRealValue(x),S=u.convertToRealValue(f);u.setExtremum({min:x,max:f,range:f-x,realMin:y,realMax:S,realRange:S-y})}const d=l.x-this._startScrollCoordinate.x;this._chart.getChartStore().getTimeScaleStore().scroll(d)}return this._chart.getChartStore().getCrosshairStore().set({x:l.x,y:l.y,paneId:o==null?void 0:o.getId()}),h}case Q:{const c=a.dispatchEvent("pressedMouseMoveEvent",l);if(c)this._chart.updatePane(1);else{const h=this._xAxisStartScaleDistance/l.pageX,u=10*(h-this._xAxisScale);this._xAxisScale=h,this._chart.getChartStore().getTimeScaleStore().zoom(u,(s=this._xAxisStartScaleCoordinate)!==null&&s!==void 0?s:void 0)}return c}case ee:{const c=a.dispatchEvent("pressedMouseMoveEvent",l);if(c)this._chart.updatePane(1);else if(this._prevYAxisExtremum!==null){const{min:h,max:u,range:d}=this._prevYAxisExtremum,g=d*(l.pageY/this._yAxisStartScaleDistance),p=(g-d)/2,m=h-p,v=u+p,_=o==null?void 0:o.getAxisComponent(),x=_.convertToRealValue(m),f=_.convertToRealValue(v);_.setExtremum({min:m,max:v,range:g,realMin:x,realMax:f,realRange:f-x}),this._chart.adjustPaneViewport(!1,!0,!0,!0)}return c}}}return!1}mouseUpEvent(e){const{widget:t}=this._findWidgetByEvent(e);let i=!1;if(t!==null){const n=this._makeWidgetEvent(e,t);switch(t.getName()){case G:case Ee:case Q:case ee:i=t.dispatchEvent("mouseUpEvent",n)}i&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,i}mouseRightClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);let i=!1;if(t!==null){const n=this._makeWidgetEvent(e,t);switch(t.getName()){case G:case Q:case ee:i=t.dispatchEvent("mouseRightClickEvent",n)}i&&this._chart.updatePane(1)}return!1}mouseDoubleClickEvent(e){const{pane:t,widget:i}=this._findWidgetByEvent(e);if(i!==null&&i.getName()===ee){const n=t==null?void 0:t.getAxisComponent();if(!n.getAutoCalcTickFlag())return n.setAutoCalcTickFlag(!0),this._chart.adjustPaneViewport(!1,!0,!0,!0),!0}return!1}mouseLeaveEvent(){return this._chart.getChartStore().getCrosshairStore().set(),!0}touchStartEvent(e){const{pane:t,widget:i}=this._findWidgetByEvent(e);if(i!==null){const n=this._makeWidgetEvent(e,i);switch(i.getName()){case G:{const s=this._chart.getChartStore(),o=s.getCrosshairStore();if(i.dispatchEvent("mouseDownEvent",n))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.set(void 0,!0),this._chart.updatePane(1),!0;if(this._flingScrollTimerId!==null&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null),this._flingStartTime=new Date().getTime(),this._startScrollCoordinate={x:n.x,y:n.y},s.getTimeScaleStore().startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const a=n.x-this._touchCoordinate.x,l=n.y-this._touchCoordinate.y;Math.sqrt(a*a+l*l)<10?(this._touchCoordinate={x:n.x,y:n.y},o.set({x:n.x,y:n.y,paneId:t==null?void 0:t.getId()})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.set())}else this._touchCancelCrosshair=!1;return!0}case Q:case ee:{const s=i.dispatchEvent("mouseDownEvent",n);return s&&this._chart.updatePane(1),s}}}return!1}touchMoveEvent(e){var t,i,n;const{pane:s,widget:o}=this._findWidgetByEvent(e);if(o!==null){const a=this._makeWidgetEvent(e,o);switch(o.getName()){case G:{if(o.dispatchEvent("pressedMouseMoveEvent",a))return(t=a.preventDefault)===null||t===void 0||t.call(a),this._chart.updatePane(1),!0;const l=this._chart.getChartStore();if(this._touchCoordinate!==null)(i=a.preventDefault)===null||i===void 0||i.call(a),l.getCrosshairStore().set({x:a.x,y:a.y,paneId:s==null?void 0:s.getId()});else if(this._startScrollCoordinate!==null&&Math.abs(this._startScrollCoordinate.x-a.x)>this._startScrollCoordinate.y-a.y){const c=a.x-this._startScrollCoordinate.x;l.getTimeScaleStore().scroll(c)}return!0}case Q:case ee:{const l=o.dispatchEvent("pressedMouseMoveEvent",a);return l&&((n=a.preventDefault)===null||n===void 0||n.call(a),this._chart.updatePane(1)),l}}}return!1}touchEndEvent(e){const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const i=this._makeWidgetEvent(e,t);switch(t.getName()){case G:if(t.dispatchEvent("mouseUpEvent",i),this._startScrollCoordinate!==null){const n=new Date().getTime()-this._flingStartTime;let s=(i.x-this._startScrollCoordinate.x)/(n>0?n:1)*20;if(n<200&&Math.abs(s)>0){const o=this._chart.getChartStore().getTimeScaleStore(),a=()=>{this._flingScrollTimerId=setTimeout(()=>{o.startScroll(),o.scroll(s),s*=.975,Math.abs(s)<1?this._flingScrollTimerId!==null&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null):a()},20)};a()}}return!0;case Q:case ee:t.dispatchEvent("mouseUpEvent",i)&&this._chart.updatePane(1)}}return!1}tapEvent(e){const{pane:t,widget:i}=this._findWidgetByEvent(e);if(i!==null&&i.getName()===G&&this._touchCoordinate===null&&!this._touchCancelCrosshair&&!this._touchZoomed){const n=this._makeWidgetEvent(e,i);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().getCrosshairStore().set({x:n.x,y:n.y,paneId:t==null?void 0:t.getId()}),!0}return!1}longTapEvent(e){const{pane:t,widget:i}=this._findWidgetByEvent(e);if(i!==null&&i.getName()===G){const n=this._makeWidgetEvent(e,i);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().getCrosshairStore().set({x:n.x,y:n.y,paneId:t==null?void 0:t.getId()}),!0}return!1}_findWidgetByEvent(e){const t=this._chart.getAllPanes(),{x:i,y:n}=e;let s=null;for(const[,a]of t){const l=a.getBounding();if(i>=l.left&&i<=l.left+l.width&&n>=l.top&&n<=l.top+l.height){s=a;break}}s===null&&(s=this._chart.getPaneById(D.XAXIS));let o=null;if(s!==null){const a=s.getSeparatorWidget();if(a!==null){const l=a.getBounding();i>=l.left&&i<=l.left+l.width&&n>=l.top&&n<=l.top+7&&(o=a)}if(o===null){const l=s.getMainWidget(),c=l.getBounding();i>=c.left&&i<=c.left+c.width&&n>=c.top&&n<=c.top+c.height&&(o=l)}if(o===null){const l=s.getYAxisWidget();if(l!==null){const c=l.getBounding();i>=c.left&&i<=c.left+c.width&&n>=c.top&&n<=c.top+c.height&&(o=l)}}}return{pane:s,widget:o}}_makeWidgetEvent(e,t){var i,n,s;const o=(i=t==null?void 0:t.getBounding())!==null&&i!==void 0?i:null;return{...e,x:e.x-((n=o==null?void 0:o.left)!==null&&n!==void 0?n:0),y:e.y-((s=o==null?void 0:o.top)!==null&&s!==void 0?s:0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}class Vt{constructor(e,t){this._panes=new Map,this._initContainer(e),this._chartEvent=new Wi(this._chartContainer,this),this._chartStore=new vi(this,t),this._xAxisPane=new Oi(this._chartContainer,this,D.XAXIS),this._panes.set(D.CANDLE,new Fi(this._chartContainer,this,D.CANDLE)),this.adjustPaneViewport(!0,!0,!0)}_initContainer(e){this._container=e,this._chartContainer=U("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer)}_measurePaneHeight(){var e;const t=this._container.offsetHeight,i=this._xAxisPane.getAxisComponent().getAutoSize();let n=t-i;n<0&&(n=0);let s=0;this._panes.forEach(l=>{if(l.getId()!==D.CANDLE){let c=l.getBounding().height;const h=l.getOptions().minHeight;c<h&&(c=h),s+c>n?(s=n,c=Math.max(n-s,0)):s+=c,l.setBounding({height:c})}});const o=n-s;(e=this._panes.get(D.CANDLE))===null||e===void 0||e.setBounding({height:o});let a=0;this._panes.forEach(l=>{l.setBounding({top:a}),a+=l.getBounding().height}),this._xAxisPane.setBounding({height:i,top:a})}_measurePaneWidth(){const e=this._chartStore.getStyles().yAxis,t=e.position==="left",i=!e.inside,n=this._container.offsetWidth;let s=0,o=Number.MIN_SAFE_INTEGER,a=0,l=0;this._panes.forEach(d=>{o=Math.max(o,d.getAxisComponent().getAutoSize())}),o>n&&(o=n),i?(s=n-o,t?(a=0,l=o):(a=n-o,l=0)):(s=n,l=0,a=t?0:n-o),this._chartStore.getTimeScaleStore().setTotalBarSpace(s);const c={width:n},h={width:s,left:l},u={width:o,left:a};this._panes.forEach(d=>{d.setBounding(c,h,u)}),this._xAxisPane.setBounding(c,h,u)}_setPaneOptions(e,t){var i,n;const s=this._panes.get((i=e==null?void 0:e.id)!==null&&i!==void 0?i:"");let o=!1;if(s!==void 0){let a=t;if(e.id!==D.CANDLE&&e.height!==void 0&&e.height>0){const l=Math.max((n=e.minHeight)!==null&&n!==void 0?n:s.getOptions().minHeight,0),c=Math.max(l,e.height);s.setBounding({height:c}),a=!0,o=!0}s.setOptions(e),a&&this.adjustPaneViewport(o,!0,!0,!0,!0)}}getContainer(){return this._container}getChartStore(){return this._chartStore}getAllPanes(){return this._panes}adjustPaneViewport(e,t,i,n,s){e&&this._measurePaneHeight();let o=t;const a=s!=null&&s;(n!=null&&n||a)&&this._panes.forEach(l=>{const c=l.getAxisComponent().buildTicks(a);o||(o=c)}),o&&this._measurePaneWidth(),i!=null&&i&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4))}updatePane(e,t){var i;t!==void 0?(i=this.getPaneById(t))===null||i===void 0||i.update(e):(this._xAxisPane.update(e),this._panes.forEach(n=>{n.update(e)}))}getPaneById(e){var t;return e===D.XAXIS?this._xAxisPane:(t=this._panes.get(e))!==null&&t!==void 0?t:null}crosshairChange(e){const t=this._chartStore.getActionStore();if(t.has("onCrosshairChange")){const i={};this._panes.forEach((n,s)=>{const o={};this._chartStore.getIndicatorStore().getInstances(s).forEach(a=>{var l;const c=a.result;o[a.name]=c[(l=e.dataIndex)!==null&&l!==void 0?l:c.length-1]}),i[s]=o}),e.paneId!==void 0&&t.execute("onCrosshairChange",{...e,indicatorData:i})}}getDom(e,t){var i,n;if(e===void 0)return this._chartContainer;{const s=this.getPaneById(e);if(s!==null)switch(t??"root"){case"root":return s.getContainer();case"main":return s.getMainWidget().getContainer();case"yAxis":return(n=(i=s.getYAxisWidget())===null||i===void 0?void 0:i.getContainer())!==null&&n!==void 0?n:null}}return null}getSize(e,t){var i,n;if(e===void 0)return{width:this._chartContainer.offsetWidth,height:this._chartContainer.offsetHeight,left:0,top:0,right:0,bottom:0};{const s=this.getPaneById(e);if(s!==null)switch(t??"root"){case"root":return s.getBounding();case"main":return s.getMainWidget().getBounding();case"yAxis":return(n=(i=s.getYAxisWidget())===null||i===void 0?void 0:i.getBounding())!==null&&n!==void 0?n:null}}return null}setStyles(e){var t,i;let n;this._chartStore.setOptions({styles:e}),n=ae(e)?xt(e):e,((t=n==null?void 0:n.yAxis)===null||t===void 0?void 0:t.type)!==void 0&&((i=this.getPaneById(D.CANDLE))===null||i===void 0||i.getAxisComponent().setAutoCalcTickFlag(!0)),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getStyles(){return this._chartStore.getStyles()}setLocale(e){this._chartStore.setOptions({locale:e}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getLocale(){return this._chartStore.getLocale()}setCustomApi(e){this._chartStore.setOptions({customApi:e}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}setPriceVolumePrecision(e,t){this._chartStore.setPrecision({price:e,volume:t})}getPriceVolumePrecision(){return this._chartStore.getPrecision()}setTimezone(e){this._chartStore.setOptions({timezone:e}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(3)}getTimezone(){return this._chartStore.getTimeScaleStore().getTimezone()}setOffsetRightDistance(e){this._chartStore.getTimeScaleStore().setOffsetRightDistance(e,!0)}setLeftMinVisibleBarCount(e){e>0&&this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(e))}setRightMinVisibleBarCount(e){e>0&&this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(e))}setBarSpace(e){this._chartStore.getTimeScaleStore().setBarSpace(e)}getBarSpace(){return this._chartStore.getTimeScaleStore().getBarSpace().bar}getVisibleRange(){return this._chartStore.getTimeScaleStore().getVisibleRange()}clearData(){this._chartStore.clearDataList()}getDataList(){return this._chartStore.getDataList()}applyNewData(e,t){this._chartStore.clearDataList(),this.applyMoreData(e,t)}applyMoreData(e,t){this._chartStore.addData(e,0,t),this._chartStore.getIndicatorStore().calcInstance().then(i=>{(i.length===0||i.includes(!0))&&this.adjustPaneViewport(!1,!0,!0,!0)}).catch(i=>{})}updateData(e){const t=this._chartStore.getDataList(),i=t.length,n=e.timestamp,s=A(t[i-1],"timestamp",0);if(n>=s){let o=i;n===s&&(o=i-1),this._chartStore.addData(e,o),this._chartStore.getIndicatorStore().calcInstance().then(a=>{(a.length===0||a.includes(!0))&&this.adjustPaneViewport(!1,!0,!0,!0)}).catch(a=>{})}}loadMore(e){this._chartStore.getTimeScaleStore().setLoadMoreCallback(e)}createIndicator(e,t,i,n){var s,o;const a=ae(e)?{name:e}:e;if(lt(a.name)===null)return null;let l;if((i==null?void 0:i.id)!==void 0&&this._panes.has(i.id))l=i.id,this._chartStore.getIndicatorStore().addInstance(a,l,t!=null&&t).then(c=>{var h,u;this._setPaneOptions(i,(u=(h=this._panes.get(l))===null||h===void 0?void 0:h.getAxisComponent().buildTicks(!0))!==null&&u!==void 0&&u)}).catch(c=>{});else{l=(s=i==null?void 0:i.id)!==null&&s!==void 0?s:ue(D.INDICATOR);const c=Array.from(this._panes.values()).pop(),h=new Rt(this._chartContainer,this,l,c);c.setBottomPane(h);const u=(o=i==null?void 0:i.height)!==null&&o!==void 0?o:100;h.setBounding({height:u}),i!=null&&h.setOptions(i),this._panes.set(l,h),this._chartStore.getIndicatorStore().addInstance(a,l,t!=null&&t).finally(()=>{this.adjustPaneViewport(!0,!0,!0,!0,!0),n==null||n()})}return l}overrideIndicator(e,t,i){this._chartStore.getIndicatorStore().override(e,t??null).then(n=>{n.length>0&&(this.adjustPaneViewport(!1,!0,!0,!0),i==null||i())}).catch(()=>{})}getIndicatorByPaneId(e,t){return this._chartStore.getIndicatorStore().getInstanceByPaneId(e,t)}removeIndicator(e,t){const i=this._chartStore.getIndicatorStore();if(i.removeInstance(e,t)){let n=!1;if(e!==D.CANDLE&&!i.hasInstances(e)){const s=this._panes.get(e);if(s!==void 0){n=!0;const o=s.getTopPane(),a=s.getBottomPane();a==null||a.setTopPane(o),o==null||o.setBottomPane(a),s==null||s.destroy(),this._panes.delete(e)}}this.adjustPaneViewport(n,!0,!0,!0,!0)}}createOverlay(e,t){const i=ae(e)?{name:e}:e;if(gt(i.name)===null)return null;let n=!0;return t!==void 0&&this.getPaneById(t)!==null||(t=D.CANDLE,n=!1),this._chartStore.getOverlayStore().addInstance(i,t,n)}getOverlayById(e){return this._chartStore.getOverlayStore().getInstanceById(e)}overrideOverlay(e){this._chartStore.getOverlayStore().override(e)}removeOverlay(e){let t;e!==void 0&&(t=ae(e)?{id:e}:e),this._chartStore.getOverlayStore().removeInstance(t)}setPaneOptions(e){this._setPaneOptions(e,!1)}setZoomEnabled(e){this._chartStore.getTimeScaleStore().setZoomEnabled(e)}isZoomEnabled(){return this._chartStore.getTimeScaleStore().getZoomEnabled()}setScrollEnabled(e){this._chartStore.getTimeScaleStore().setScrollEnabled(e)}isScrollEnabled(){return this._chartStore.getTimeScaleStore().getScrollEnabled()}scrollByDistance(e,t){const i=t===void 0||t<0?0:t,n=this._chartStore.getTimeScaleStore();if(i>0){n.startScroll();const s=new Date().getTime(),o=()=>{const a=(new Date().getTime()-s)/i,l=a>=1,c=l?e:e*a;n.scroll(c),l||requestAnimationFrame(o)};o()}else n.startScroll(),n.scroll(e)}scrollToRealTime(e){const t=this._chartStore.getTimeScaleStore(),{bar:i}=t.getBarSpace(),n=(t.getOffsetRightBarCount()-t.getOffsetRightDistance()/i)*i;this.scrollByDistance(n,e)}scrollToDataIndex(e,t){const i=this._chartStore.getTimeScaleStore(),n=(i.getOffsetRightBarCount()+(this.getDataList().length-1-e))*i.getBarSpace().bar;this.scrollByDistance(n,t)}scrollToTimestamp(e,t){const i=Xe(this.getDataList(),"timestamp",e);this.scrollToDataIndex(i,t)}zoomAtCoordinate(e,t,i){const n=i===void 0||i<0?0:i,s=this._chartStore.getTimeScaleStore();if(n>0){const{bar:o}=s.getBarSpace(),a=o*e-o,l=new Date().getTime(),c=()=>{const h=(new Date().getTime()-l)/n,u=h>=1,d=u?a:a*h;s.zoom(d/o,t),u||requestAnimationFrame(c)};c()}else s.zoom(e,t)}zoomAtDataIndex(e,t,i){const n=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:n,y:0},i)}zoomAtTimestamp(e,t,i){const n=Xe(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,n,i)}convertToPixel(e,t){var i;const{paneId:n=D.CANDLE,absolute:s=!1}=t;let o=[];if(n!==D.XAXIS){const a=this.getPaneById(n);if(a!==null){const l=this._chartStore.getTimeScaleStore(),c=a.getBounding(),h=new Array().concat(e),u=this._xAxisPane.getAxisComponent(),d=a.getAxisComponent();o=h.map(g=>{const p={};let m=g.dataIndex;if(g.timestamp!==void 0&&(m=l.timestampToDataIndex(g.timestamp)),m!==void 0&&(p.x=u==null?void 0:u.convertToPixel(m)),g.value!==void 0){const v=d==null?void 0:d.convertToPixel(g.value);p.y=s?c.top+v:v}return p})}}return se(e)?o:(i=o[0])!==null&&i!==void 0?i:{}}convertFromPixel(e,t){var i;const{paneId:n=D.CANDLE,absolute:s=!1}=t;let o=[];if(n!==D.XAXIS){const a=this.getPaneById(n);if(a!==null){const l=this._chartStore.getTimeScaleStore(),c=a.getBounding(),h=new Array().concat(e),u=this._xAxisPane.getAxisComponent(),d=a.getAxisComponent();o=h.map(g=>{var p;const m={};if(g.x!==void 0){const v=u.convertFromPixel(g.x);m.dataIndex=v,m.timestamp=(p=l.dataIndexToTimestamp(v))!==null&&p!==void 0?p:void 0}if(g.y!==void 0){const v=s?g.y-c.top:g.y;m.value=d.convertFromPixel(v)}return m})}}return se(e)?o:(i=o[0])!==null&&i!==void 0?i:{}}subscribeAction(e,t){this._chartStore.getActionStore().subscribe(e,t)}unsubscribeAction(e,t){this._chartStore.getActionStore().unsubscribe(e,t)}getConvertPictureUrl(e,t,i){const n=this._chartContainer.offsetWidth,s=this._chartContainer.offsetHeight,o=U("canvas",{width:`${n}px`,height:`${s}px`,boxSizing:"border-box"}),a=o.getContext("2d"),l=pe(o);o.width=n*l,o.height=s*l,a.scale(l,l),a.fillStyle=i??"#FFFFFF",a.fillRect(0,0,n,s);const c=e!=null&&e;this._panes.forEach(u=>{const d=u.getBounding();a.drawImage(u.getImage(c),0,d.top,n,d.height)});const h=this._xAxisPane.getBounding();return a.drawImage(this._xAxisPane.getImage(c),0,h.top,n,h.height),o.toDataURL(`image/${t??"jpeg"}`)}resize(){this.adjustPaneViewport(!0,!0,!0,!0,!0)}destroy(){this._chartEvent.destroy(),this._panes.forEach(e=>{e.destroy()}),this._panes.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer)}}const Oe={};let Yi=1;const Hi={clone:He,merge:ne,isString:ae,isNumber:ke,isValid:L,isObject:K,isArray:se,isFunction:Pe,isBoolean:function(r){return typeof r=="boolean"},formatValue:A,formatPrecision:B,formatBigNumber:ot,formatDate:st,getLinearSlopeIntercept:Be,getLinearYFromSlopeIntercept:Ge,getLinearYFromCoordinates:we,checkCoordinateOnArc:function(r,e){if(Math.abs(function(t,i){const n=t.x-i.x,s=t.y-i.y;return Math.sqrt(n*n+s*s)}(r,e)-e.r)<Ie){const{r:t,startAngle:i,endAngle:n}=e,s=t*Math.cos(i)+e.x,o=t*Math.sin(i)+e.y,a=t*Math.cos(n)+e.x,l=t*Math.sin(n)+e.y;return r.x<=Math.max(s,a)+Ie&&r.x>=Math.min(s,a)-Ie&&r.y<=Math.max(o,l)+Ie&&r.y>=Math.min(o,l)-Ie}return!1},checkCoordinateOnCircle:St,checkCoordinateOnLine:ht,checkCoordinateOnPolygon:bt,checkCoordinateOnRect:Et,checkCoordinateOnText:qe,drawArc:function(r,e,t){const{x:i,y:n,r:s,startAngle:o,endAngle:a}=e,{style:l="solid",size:c=1,color:h="currentColor",dashedValue:u=[2,2]}=t;r.lineWidth=c,r.strokeStyle=h,l==="dashed"?r.setLineDash(u):r.setLineDash([]),r.beginPath(),r.arc(i,n,s,o,a),r.stroke(),r.closePath()},drawCircle:Ct,drawLine:ut,drawPolygon:wt,drawRect:Ze,drawText:Ke,drawRectText:Tt};M.dispose=function(r){var e;let t;if(ae(r)){const i=document.getElementById(r);t=(e=i==null?void 0:i.getAttribute("chartId"))!==null&&e!==void 0?e:null}else t=r instanceof Vt?r.id:r??r.chartId;t!==null&&(Oe[t].destroy(),delete Oe[t])},M.getFigureClass=function(r){var e;return(e=Te[r])!==null&&e!==void 0?e:null},M.getSupportedFigures=function(){return Object.keys(Te)},M.getSupportedIndicators=function(){return Object.keys(Fe)},M.getSupportedLocales=function(){return Object.keys(Ve)},M.getSupportedOverlays=function(){return Object.keys(Re)},M.init=function(r,e){var t;let i;if(i=ae(r)?document.getElementById(r):r,i===null)return null;let n=Oe[(t=i.chartId)!==null&&t!==void 0?t:""];if(n!==void 0)return n;const s="k_line_chart_"+Yi++;return n=new Vt(i,e),n.id=s,i.chartId=s,Oe[s]=n,n},M.registerFigure=function(r){Te[r.name]=Ne.extend(r)},M.registerIndicator=function(r){Fe[r.name]=Ae.extend(r)},M.registerLocale=function(r,e){Ve[r]={...Ve[r],...e}},M.registerOverlay=function(r){Re[r.name]=Le.extend(r)},M.registerStyles=function(r,e){_t[r]=e},M.utils=Hi,M.version=function(){return"9.0.0-alpha7"}})})(ln,We);(function(V){V.exports=We})(an);const cn="/binance-clone/assets/miniP-51885aa4.svg",hn={data(){return{data:null,currencies:null,currency:"BTC"}},async created(){this.loadChart(),this.getCurrencies()},name:"SimpleChart",methods:{runChart(V){const F=ze.init("simple_chart");F.createIndicator("MA",!1,{id:"candle_pane"}),F.createIndicator("VOL"),F.applyNewData(V)},async loadChart(){this.data=await jt.getMarketPriceHistory(this.currency),this.runChart(this.data)},async getCurrencies(){this.currencies=await jt.getCurrencies(),console.log("this.currencies: ",this.currencies)},reLoad(){this.loadChart()}},destroyed:function(){ze.dispose("simple_chart")}},un={class:"dashboard"},dn=["value"],gn=Me("p",{style:{"font-size":"12px"}},[Me("img",{src:cn,alt:""}),qi(" Bitcoin Price ")],-1),vn=Me("div",{id:"simple_chart",style:{height:"600px"}},null,-1);function mn(V,F,M,$,ue,U){return it(),nt("section",un,[Me("h2",null,Gt(ue.currency)+"/USDT",1),Gi(Me("select",{"onUpdate:modelValue":F[0]||(F[0]=Z=>ue.currency=Z),onChange:F[1]||(F[1]=(...Z)=>U.reLoad&&U.reLoad(...Z))},[(it(!0),nt(Ui,null,Zi(ue.currencies,Z=>(it(),nt("option",{value:Z,key:Z},Gt(Z),9,dn))),128))],544),[[ji,ue.currency]]),gn,vn])}const _n=$i(hn,[["render",mn]]);export{_n as default};
